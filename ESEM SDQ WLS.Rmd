---
title: "ESEM SDQ One Factor Model Time Point 1"
author: "Vas Stavropoulos Qasim Latifi based on Maria Prokofieva Syntax"
date: "28/02/2022"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Fist step: Install and Run your package library
#install.packages("lavaan")
#install.packages("lavaanPlot")
#install.packages("semPlot")
#install.packages("EFA.dimensions")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("semtools)
library(lavaan)
library(lavaanPlot)
library(semPlot)
library(EFA.dimensions)
library(tidyverse)
library(psych)
library(semTools)
library (haven)
```
Second step: Import, access and assess the descriptives of your data. Data needs to be placed in the same file that connects with your github directory.You only need to replace your file's name on the following R syntax.

```{r}
data<-haven::read_sav("DATA.sav")%>%
  mutate_if(is.character, as.factor) 
glimpse(data)
knitr::kable(describe(data), caption = "Descriptive stats", digits = 2)
```
Third step: Create and use EFA "blocks" as part of a SEM model. 
EFA blocks can use either *Geomin* rotation or *target* rotations.
Both types of rotations are oblique, meaning they reorient the factors so that they fall closer to clusters of vectors representing manifest variables, thereby simplifying the mathematical description of the manifest variables. Usually geomin rotation outperforms target.
Reminding that the SDQ five factor item structure is as following:
Peer problems (PP)
"s6_1", "s11_1R", "s14_1R", "s19_1", "s23_1"
  
Conduct problems (CP)
"s5_1", "s7_1R", "s12_1", "s18_1", "s22_1"

Emotional Symptoms (ES)
"s3_1", "s8_1", "s13_1", "s16_1", "s24_1"

Hyperactivity/inattention (HA)
"s2_1","s10_1","s15_1","s21_1R","s25_1R"

Prosocial (PS)
"s1_1","s4_1","s9_1","s17_1","s20_1"
Thus we first create a main factors items' loadings list object.

```{r}
main_loadings_list <- list(
                          OneFactorModel_TimePoint1 = c("s1_1", "s2_1", "s3_1", "s4_1", "s5_1", "s6_1", "s7_1R", "s8_1", "s9_1", "s10_1", "s11_1R", "s12_1", "s13_1", "s14_1R", "s15_1", "s16_1", "s17_1", "s18_1", "s19_1", "s20_1", "s21_1R", "s22_1", "s23_1", "s24_1", "s25_1R"))

                          
```
Then based on the list created you select the factor columns required for your ESEM.
```{r}
data_esem<-data%>%
  select(all_of(unlist(main_loadings_list, use.names=FALSE)))
knitr::kable(describe(data_esem), caption = "Descriptive stats", digits = 2)
```
Then you rotate and use the loadings of this rotation for the preselected factors and items are calculated as a new object
```{r}
geomin_rot <- make.keys(data_esem, main_loadings_list)%>%
  scrub(isvalue = 1)
geomin_rot
knitr::kable(describe(geomin_rot), caption = "Descriptive stats", digits = 2)
```
From the ESEM data remove missing values before using for either EFA and CFA analyses.
```{r}
data_esemcomplete<-data_esem[complete.cases(data_esem),]
knitr::kable(describe(data_esemcomplete), caption = "Descriptive stats", digits = 2)
```
More cleaning is needed as -3 scores exist and SDQ should not have negative scores
Thus an extra cleaning step should be added before progressing.
The next step is for the ESEM five factor modelas a new object to be calculated before fitted.
```{r}
esem_loadings<-as_tibble(geomin_rot, rownames=NA)%>%
  rownames_to_column(var = "item")
fixed<-0.4
syntax<-esem_loadings%>%
  pivot_longer(-item, names_to="latent", values_to="value" )%>%
  mutate(is_anchor=case_when(
           is.na(value) ~ TRUE,
           TRUE ~ FALSE 
           ),
         syntax=case_when(
           is_anchor ~ item,
           TRUE ~ paste0("start(",fixed,")*", item)
         )
  )%>%
  select(latent, syntax)
esem_model<-syntax%>%
  group_by(latent)%>%
  mutate(syntax=paste0(latent, "=~", paste0(syntax, collapse="+")))%>%
  distinct(latent, .keep_all = TRUE)%>%
  ungroup()%>%
  select(-latent)
  
esem_model<-paste0(esem_model$syntax, "\n", collapse="")
writeLines(esem_model)
```
Finally we fit the model and claulate the reliabilities
```{r}
esem_fit <- cfa(esem_model, data_esem, std.lv=T, estimator="WLS")
summary(esem_fit, fit.measures=TRUE, standardized=TRUE)
reliability(esem_fit, omit.imps = c("no.conv", "no.se"))
lavaanPlot(model = esem_fit, coefs = TRUE,
           stand = TRUE,
           edge_options = list(color ='grey'))
```


---
title: "ESEM SDQ One Factor Model Time Point 2"
author: "Vas Stavropoulos Qasim Latifi based on Maria Prokofieva Syntax"
date: "28/02/2022"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Fist step: Install and Run your package library
#install.packages("lavaan")
#install.packages("lavaanPlot")
#install.packages("semPlot")
#install.packages("EFA.dimensions")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("semtools)
library(lavaan)
library(lavaanPlot)
library(semPlot)
library(EFA.dimensions)
library(tidyverse)
library(psych)
library(semTools)
library (haven)
```
Second step: Import, access and assess the descriptives of your data. Data needs to be placed in the same file that connects with your github directory.You only need to replace your file's name on the following R syntax.

```{r}
data<-haven::read_sav("DATA.sav")%>%
  mutate_if(is.character, as.factor) 
glimpse(data)
knitr::kable(describe(data), caption = "Descriptive stats", digits = 2)
```
Third step: Create and use EFA "blocks" as part of a SEM model. 
EFA blocks can use either *Geomin* rotation or *target* rotations.
Both types of rotations are oblique, meaning they reorient the factors so that they fall closer to clusters of vectors representing manifest variables, thereby simplifying the mathematical description of the manifest variables. Usually geomin rotation outperforms target.
Reminding that the SDQ five factor item structure is as following:
Peer problems (PP)
"s6_1", "s11_1R", "s14_1R", "s19_1", "s23_1"
  
Conduct problems (CP)
"s5_1", "s7_1R", "s12_1", "s18_1", "s22_1"

Emotional Symptoms (ES)
"s3_1", "s8_1", "s13_1", "s16_1", "s24_1"

Hyperactivity/inattention (HA)
"s2_1","s10_1","s15_1","s21_1R","s25_1R"

Prosocial (PS)
"s1_1","s4_1","s9_1","s17_1","s20_1"
Thus we first create a main factors items' loadings list object.

```{r}
main_loadings_list <- list(
                          OneFactorModel_TimePoint2 = c("s1_2", "s2_2", "s3_2", "s4_2", "s5_2", "s6_2", "s7_2R", "s8_2", "s9_2", "s10_2", "s11_2R", "s12_2", "s13_2", "s14_2R", "s15_2", "s16_2", "s17_2", "s18_2", "s19_2", "s20_2", "s21_2R", "s22_2", "s23_2", "s24_2", "s25_2R"))

                          
```
Then based on the list created you select the factor columns required for your ESEM.
```{r}
data_esem<-data%>%
  select(all_of(unlist(main_loadings_list, use.names=FALSE)))
knitr::kable(describe(data_esem), caption = "Descriptive stats", digits = 2)
```
Then you rotate and use the loadings of this rotation for the preselected factors and items are calculated as a new object
```{r}
geomin_rot <- make.keys(data_esem, main_loadings_list)%>%
  scrub(isvalue = 1)
geomin_rot
knitr::kable(describe(geomin_rot), caption = "Descriptive stats", digits = 2)
```
From the ESEM data remove missing values before using for either EFA and CFA analyses.
```{r}
data_esemcomplete<-data_esem[complete.cases(data_esem),]
knitr::kable(describe(data_esemcomplete), caption = "Descriptive stats", digits = 2)
```
More cleaning is needed as -3 scores exist and SDQ should not have negative scores
Thus an extra cleaning step should be added before progressing.
The next step is for the ESEM five factor modelas a new object to be calculated before fitted.
```{r}
esem_loadings<-as_tibble(geomin_rot, rownames=NA)%>%
  rownames_to_column(var = "item")
fixed<-0.4
syntax<-esem_loadings%>%
  pivot_longer(-item, names_to="latent", values_to="value" )%>%
  mutate(is_anchor=case_when(
           is.na(value) ~ TRUE,
           TRUE ~ FALSE 
           ),
         syntax=case_when(
           is_anchor ~ item,
           TRUE ~ paste0("start(",fixed,")*", item)
         )
  )%>%
  select(latent, syntax)
esem_model<-syntax%>%
  group_by(latent)%>%
  mutate(syntax=paste0(latent, "=~", paste0(syntax, collapse="+")))%>%
  distinct(latent, .keep_all = TRUE)%>%
  ungroup()%>%
  select(-latent)
  
esem_model<-paste0(esem_model$syntax, "\n", collapse="")
writeLines(esem_model)
```
Finally we fit the model and claulate the reliabilities
```{r}
esem_fit <- cfa(esem_model, data_esem, std.lv=T, estimator="WLS")
summary(esem_fit, fit.measures=TRUE, standardized=TRUE)
reliability(esem_fit, omit.imps = c("no.conv", "no.se"))
lavaanPlot(model = esem_fit, coefs = TRUE,
           stand = TRUE,
           edge_options = list(color ='grey'))
```


---
title: "ESEM SDQ One Factor Model Time Point 3"
author: "Vas Stavropoulos Qasim Latifi based on Maria Prokofieva Syntax"
date: "28/02/2022"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Fist step: Install and Run your package library
#install.packages("lavaan")
#install.packages("lavaanPlot")
#install.packages("semPlot")
#install.packages("EFA.dimensions")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("semtools)
library(lavaan)
library(lavaanPlot)
library(semPlot)
library(EFA.dimensions)
library(tidyverse)
library(psych)
library(semTools)
library (haven)
```
Second step: Import, access and assess the descriptives of your data. Data needs to be placed in the same file that connects with your github directory.You only need to replace your file's name on the following R syntax.

```{r}
data<-haven::read_sav("DATA.sav")%>%
  mutate_if(is.character, as.factor) 
glimpse(data)
knitr::kable(describe(data), caption = "Descriptive stats", digits = 2)
```
Third step: Create and use EFA "blocks" as part of a SEM model. 
EFA blocks can use either *Geomin* rotation or *target* rotations.
Both types of rotations are oblique, meaning they reorient the factors so that they fall closer to clusters of vectors representing manifest variables, thereby simplifying the mathematical description of the manifest variables. Usually geomin rotation outperforms target.
Reminding that the SDQ five factor item structure is as following:
Peer problems (PP)
"s6_1", "s11_1R", "s14_1R", "s19_1", "s23_1"
  
Conduct problems (CP)
"s5_1", "s7_1R", "s12_1", "s18_1", "s22_1"

Emotional Symptoms (ES)
"s3_1", "s8_1", "s13_1", "s16_1", "s24_1"

Hyperactivity/inattention (HA)
"s2_1","s10_1","s15_1","s21_1R","s25_1R"

Prosocial (PS)
"s1_1","s4_1","s9_1","s17_1","s20_1"
Thus we first create a main factors items' loadings list object.

```{r}
main_loadings_list <- list(
                          OneFactorModel_TimePoint3 = c("s1_3", "s2_3", "s3_3", "s4_3", "s5_3", "s6_3", "s7_3R", "s8_3", "s9_3", "s10_3", "s11_3R", "s12_3", "s13_3", "s14_3R", "s15_3", "s16_3", "s17_3", "s18_3", "s19_3", "s20_3", "s21_3R", "s22_3", "s23_3", "s24_3", "s25_3R"))

                          
```
Then based on the list created you select the factor columns required for your ESEM.
```{r}
data_esem<-data%>%
  select(all_of(unlist(main_loadings_list, use.names=FALSE)))
knitr::kable(describe(data_esem), caption = "Descriptive stats", digits = 2)
```
Then you rotate and use the loadings of this rotation for the preselected factors and items are calculated as a new object
```{r}
geomin_rot <- make.keys(data_esem, main_loadings_list)%>%
  scrub(isvalue = 1)
geomin_rot
knitr::kable(describe(geomin_rot), caption = "Descriptive stats", digits = 2)
```
From the ESEM data remove missing values before using for either EFA and CFA analyses.
```{r}
data_esemcomplete<-data_esem[complete.cases(data_esem),]
knitr::kable(describe(data_esemcomplete), caption = "Descriptive stats", digits = 2)
```
More cleaning is needed as -3 scores exist and SDQ should not have negative scores
Thus an extra cleaning step should be added before progressing.
The next step is for the ESEM five factor modelas a new object to be calculated before fitted.
```{r}
esem_loadings<-as_tibble(geomin_rot, rownames=NA)%>%
  rownames_to_column(var = "item")
fixed<-0.4
syntax<-esem_loadings%>%
  pivot_longer(-item, names_to="latent", values_to="value" )%>%
  mutate(is_anchor=case_when(
           is.na(value) ~ TRUE,
           TRUE ~ FALSE 
           ),
         syntax=case_when(
           is_anchor ~ item,
           TRUE ~ paste0("start(",fixed,")*", item)
         )
  )%>%
  select(latent, syntax)
esem_model<-syntax%>%
  group_by(latent)%>%
  mutate(syntax=paste0(latent, "=~", paste0(syntax, collapse="+")))%>%
  distinct(latent, .keep_all = TRUE)%>%
  ungroup()%>%
  select(-latent)
  
esem_model<-paste0(esem_model$syntax, "\n", collapse="")
writeLines(esem_model)
```
Finally we fit the model and claulate the reliabilities
```{r}
esem_fit <- cfa(esem_model, data_esem, std.lv=T, estimator="WLS")
summary(esem_fit, fit.measures=TRUE, standardized=TRUE)
reliability(esem_fit, omit.imps = c("no.conv", "no.se"))
lavaanPlot(model = esem_fit, coefs = TRUE,
           stand = TRUE,
           edge_options = list(color ='grey'))
```

---
title: "ESEM SDQ Two Factor Model Timepoint 1"
author: "Vas Stavropoulos Qasim Latifi based on Maria Prokofieva Syntax"
date: "28/02/2022"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Fist step: Install and Run your package library
#install.packages("lavaan")
#install.packages("lavaanPlot")
#install.packages("semPlot")
#install.packages("EFA.dimensions")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("semtools)
library(lavaan)
library(lavaanPlot)
library(semPlot)
library(EFA.dimensions)
library(tidyverse)
library(psych)
library(semTools)
library (haven)
```
Second step: Import, access and assess the descriptives of your data. Data needs to be placed in the same file that connects with your github directory.You only need to replace your file's name on the following R syntax.

```{r}
data<-haven::read_sav("DATA.sav")%>%
  mutate_if(is.character, as.factor) 
glimpse(data)
knitr::kable(describe(data), caption = "Descriptive stats", digits = 2)
```
Third step: Create and use EFA "blocks" as part of a SEM model. 
EFA blocks can use either *Geomin* rotation or *target* rotations.
Both types of rotations are oblique, meaning they reorient the factors so that they fall closer to clusters of vectors representing manifest variables, thereby simplifying the mathematical description of the manifest variables. Usually geomin rotation outperforms target.

```{r}
main_loadings_list <- list(
                          Difficulties = c("s2_1", "s3_1", "s5_1", "s6_1", "s7_1R", "s8_1", "s10_1", "s11_1R", "s12_1", "s13_1", "s14_1R", "s15_1", "s16_1", "s18_1", "s19_1", "s21_1R", "s22_1", "s23_1", "s24_1", "s25_1R"),
                          Prosocial = c("s1_1", "s4_1", "s9_1", "s17_1", "s20_1"))

                          
```
Then based on the list created you select the factor columns required for your ESEM.
```{r}
data_esem<-data%>%
  select(all_of(unlist(main_loadings_list, use.names=FALSE)))
knitr::kable(describe(data_esem), caption = "Descriptive stats", digits = 2)
```
Then you rotate and use the loadings of this rotation for the preselected factors and items are calculated as a new object
```{r}
geomin_rot <- make.keys(data_esem, main_loadings_list)%>%
  scrub(isvalue = 1)
geomin_rot
knitr::kable(describe(geomin_rot), caption = "Descriptive stats", digits = 2)
```
From the ESEM data remove missing values before using for either EFA and CFA analyses.
```{r}
data_esemcomplete<-data_esem[complete.cases(data_esem),]
knitr::kable(describe(data_esemcomplete), caption = "Descriptive stats", digits = 2)
```
More cleaning is needed as -3 scores exist and SDQ should not have negative scores
Thus an extra cleaning step should be added before progressing.
The next step is for the ESEM five factor modelas a new object to be calculated before fitted.
```{r}
esem_loadings<-as_tibble(geomin_rot, rownames=NA)%>%
  rownames_to_column(var = "item")
fixed<-0.4
syntax<-esem_loadings%>%
  pivot_longer(-item, names_to="latent", values_to="value" )%>%
  mutate(is_anchor=case_when(
           is.na(value) ~ TRUE,
           TRUE ~ FALSE 
           ),
         syntax=case_when(
           is_anchor ~ item,
           TRUE ~ paste0("start(",fixed,")*", item)
         )
  )%>%
  select(latent, syntax)
esem_model<-syntax%>%
  group_by(latent)%>%
  mutate(syntax=paste0(latent, "=~", paste0(syntax, collapse="+")))%>%
  distinct(latent, .keep_all = TRUE)%>%
  ungroup()%>%
  select(-latent)
  
esem_model<-paste0(esem_model$syntax, "\n", collapse="")
writeLines(esem_model)
```
Finally we fit the model and claulate the reliabilities
```{r}
esem_fit <- cfa(esem_model, data_esem, std.lv=T, estimator="WLS")
summary(esem_fit, fit.measures=TRUE, standardized=TRUE)
reliability(esem_fit, omit.imps = c("no.conv", "no.se"))
lavaanPlot(model = esem_fit, coefs = TRUE,
           stand = TRUE,
           edge_options = list(color ='grey'))
```

---
title: "ESEM SDQ Two Factor Model Timepoint 2"
author: "Vas Stavropoulos Qasim Latifi based on Maria Prokofieva Syntax"
date: "28/02/2022"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Fist step: Install and Run your package library
#install.packages("lavaan")
#install.packages("lavaanPlot")
#install.packages("semPlot")
#install.packages("EFA.dimensions")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("semtools)
library(lavaan)
library(lavaanPlot)
library(semPlot)
library(EFA.dimensions)
library(tidyverse)
library(psych)
library(semTools)
library (haven)
```
Second step: Import, access and assess the descriptives of your data. Data needs to be placed in the same file that connects with your github directory.You only need to replace your file's name on the following R syntax.

```{r}
data<-haven::read_sav("DATA.sav")%>%
  mutate_if(is.character, as.factor) 
glimpse(data)
knitr::kable(describe(data), caption = "Descriptive stats", digits = 2)
```
Third step: Create and use EFA "blocks" as part of a SEM model. 
EFA blocks can use either *Geomin* rotation or *target* rotations.
Both types of rotations are oblique, meaning they reorient the factors so that they fall closer to clusters of vectors representing manifest variables, thereby simplifying the mathematical description of the manifest variables. Usually geomin rotation outperforms target.

```{r}
main_loadings_list <- list(
                          Difficulties = c("s2_2", "s3_2", "s5_2", "s6_2", "s7_2R", "s8_2", "s10_2", "s11_2R", "s12_2", "s13_2", "s14_2R", "s15_2", "s16_2", "s18_2", "s19_2", "s21_2R", "s22_2", "s23_2", "s24_2", "s25_2R"),
                          Prosocial = c("s1_2", "s4_2", "s9_2", "s17_2", "s20_2"))

                          
```
Then based on the list created you select the factor columns required for your ESEM.
```{r}
data_esem<-data%>%
  select(all_of(unlist(main_loadings_list, use.names=FALSE)))
knitr::kable(describe(data_esem), caption = "Descriptive stats", digits = 2)
```
Then you rotate and use the loadings of this rotation for the preselected factors and items are calculated as a new object
```{r}
geomin_rot <- make.keys(data_esem, main_loadings_list)%>%
  scrub(isvalue = 1)
geomin_rot
knitr::kable(describe(geomin_rot), caption = "Descriptive stats", digits = 2)
```
From the ESEM data remove missing values before using for either EFA and CFA analyses.
```{r}
data_esemcomplete<-data_esem[complete.cases(data_esem),]
knitr::kable(describe(data_esemcomplete), caption = "Descriptive stats", digits = 2)
```
More cleaning is needed as -3 scores exist and SDQ should not have negative scores
Thus an extra cleaning step should be added before progressing.
The next step is for the ESEM five factor modelas a new object to be calculated before fitted.
```{r}
esem_loadings<-as_tibble(geomin_rot, rownames=NA)%>%
  rownames_to_column(var = "item")
fixed<-0.4
syntax<-esem_loadings%>%
  pivot_longer(-item, names_to="latent", values_to="value" )%>%
  mutate(is_anchor=case_when(
           is.na(value) ~ TRUE,
           TRUE ~ FALSE 
           ),
         syntax=case_when(
           is_anchor ~ item,
           TRUE ~ paste0("start(",fixed,")*", item)
         )
  )%>%
  select(latent, syntax)
esem_model<-syntax%>%
  group_by(latent)%>%
  mutate(syntax=paste0(latent, "=~", paste0(syntax, collapse="+")))%>%
  distinct(latent, .keep_all = TRUE)%>%
  ungroup()%>%
  select(-latent)
  
esem_model<-paste0(esem_model$syntax, "\n", collapse="")
writeLines(esem_model)
```
Finally we fit the model and claulate the reliabilities
```{r}
esem_fit <- cfa(esem_model, data_esem, std.lv=T, estimator="WLS")
summary(esem_fit, fit.measures=TRUE, standardized=TRUE)
reliability(esem_fit, omit.imps = c("no.conv", "no.se"))
lavaanPlot(model = esem_fit, coefs = TRUE,
           stand = TRUE,
           edge_options = list(color ='grey'))
```

---
title: "ESEM SDQ Two Factor Model Timepoint 3"
author: "Vas Stavropoulos Qasim Latifi based on Maria Prokofieva Syntax"
date: "28/02/2022"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Fist step: Install and Run your package library
#install.packages("lavaan")
#install.packages("lavaanPlot")
#install.packages("semPlot")
#install.packages("EFA.dimensions")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("semtools)
library(lavaan)
library(lavaanPlot)
library(semPlot)
library(EFA.dimensions)
library(tidyverse)
library(psych)
library(semTools)
library (haven)
```
Second step: Import, access and assess the descriptives of your data. Data needs to be placed in the same file that connects with your github directory.You only need to replace your file's name on the following R syntax.

```{r}
data<-haven::read_sav("DATA.sav")%>%
  mutate_if(is.character, as.factor) 
glimpse(data)
knitr::kable(describe(data), caption = "Descriptive stats", digits = 2)
```
Third step: Create and use EFA "blocks" as part of a SEM model. 
EFA blocks can use either *Geomin* rotation or *target* rotations.
Both types of rotations are oblique, meaning they reorient the factors so that they fall closer to clusters of vectors representing manifest variables, thereby simplifying the mathematical description of the manifest variables. Usually geomin rotation outperforms target.

```{r}
main_loadings_list <- list(
                          Difficulties = c("s2_3", "s3_3", "s5_3", "s6_3", "s7_3R", "s8_3", "s10_3", "s11_3R", "s12_3", "s13_3", "s14_3R", "s15_3", "s16_3", "s18_3", "s19_3", "s21_3R", "s22_3", "s23_3", "s24_3", "s25_3R"),
                          Prosocial = c("s1_3", "s4_3", "s9_3", "s17_3", "s20_3"))

                          
```
Then based on the list created you select the factor columns required for your ESEM.
```{r}
data_esem<-data%>%
  select(all_of(unlist(main_loadings_list, use.names=FALSE)))
knitr::kable(describe(data_esem), caption = "Descriptive stats", digits = 2)
```
Then you rotate and use the loadings of this rotation for the preselected factors and items are calculated as a new object
```{r}
geomin_rot <- make.keys(data_esem, main_loadings_list)%>%
  scrub(isvalue = 1)
geomin_rot
knitr::kable(describe(geomin_rot), caption = "Descriptive stats", digits = 2)
```
From the ESEM data remove missing values before using for either EFA and CFA analyses.
```{r}
data_esemcomplete<-data_esem[complete.cases(data_esem),]
knitr::kable(describe(data_esemcomplete), caption = "Descriptive stats", digits = 2)
```
More cleaning is needed as -3 scores exist and SDQ should not have negative scores
Thus an extra cleaning step should be added before progressing.
The next step is for the ESEM five factor modelas a new object to be calculated before fitted.
```{r}
esem_loadings<-as_tibble(geomin_rot, rownames=NA)%>%
  rownames_to_column(var = "item")
fixed<-0.4
syntax<-esem_loadings%>%
  pivot_longer(-item, names_to="latent", values_to="value" )%>%
  mutate(is_anchor=case_when(
           is.na(value) ~ TRUE,
           TRUE ~ FALSE 
           ),
         syntax=case_when(
           is_anchor ~ item,
           TRUE ~ paste0("start(",fixed,")*", item)
         )
  )%>%
  select(latent, syntax)
esem_model<-syntax%>%
  group_by(latent)%>%
  mutate(syntax=paste0(latent, "=~", paste0(syntax, collapse="+")))%>%
  distinct(latent, .keep_all = TRUE)%>%
  ungroup()%>%
  select(-latent)
  
esem_model<-paste0(esem_model$syntax, "\n", collapse="")
writeLines(esem_model)
```
Finally we fit the model and claulate the reliabilities
```{r}
esem_fit <- cfa(esem_model, data_esem, std.lv=T, estimator="WLS")
summary(esem_fit, fit.measures=TRUE, standardized=TRUE)
reliability(esem_fit, omit.imps = c("no.conv", "no.se"))
lavaanPlot(model = esem_fit, coefs = TRUE,
           stand = TRUE,
           edge_options = list(color ='grey'))
```


---
title: "ESEM SDQ Three Factor Model Time Point 1"
author: "Vas Stavropoulos Qasim Latifi based on Maria Prokofieva Syntax"
date: "28/02/2022"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Fist step: Install and Run your package library
#install.packages("lavaan")
#install.packages("lavaanPlot")
#install.packages("semPlot")
#install.packages("EFA.dimensions")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("semtools)
library(lavaan)
library(lavaanPlot)
library(semPlot)
library(EFA.dimensions)
library(tidyverse)
library(psych)
library(semTools)
library (haven)
```
Second step: Import, access and assess the descriptives of your data. Data needs to be placed in the same file that connects with your github directory.You only need to replace your file's name on the following R syntax.

```{r}
data<-haven::read_sav("DATA.sav")%>%
  mutate_if(is.character, as.factor) 
glimpse(data)
knitr::kable(describe(data), caption = "Descriptive stats", digits = 2)
```
Third step: Create and use EFA "blocks" as part of a SEM model. 
EFA blocks can use either *Geomin* rotation or *target* rotations.
Both types of rotations are oblique, meaning they reorient the factors so that they fall closer to clusters of vectors representing manifest variables, thereby simplifying the mathematical description of the manifest variables. Usually geomin rotation outperforms target.

Thus we first create a main factors items' loadings list object.

```{r}
main_loadings_list <- list(
                        ID= c("s3_1", "s8_1", "s13_1", "s16_1", "s24_1", "s6_1", "s11_1R", "s14_1R", "s19_1", "s23_1"),
                        ED= c("s5_1", "s7_1R", "s12_1", "s18_1", "s22_1", "s2_1", "s10_1", "s15_1", "s21_1R", "s25_1R"),
                        ProSocial= c("s1_1", "s4_1", "s9_1", "s17_1", "s20_1"))

                          
```
Then based on the list created you select the factor columns required for your ESEM.
```{r}
data_esem<-data%>%
  select(all_of(unlist(main_loadings_list, use.names=FALSE)))
knitr::kable(describe(data_esem), caption = "Descriptive stats", digits = 2)
```
Then you rotate and use the loadings of this rotation for the preselected factors and items are calculated as a new object
```{r}
geomin_rot <- make.keys(data_esem, main_loadings_list)%>%
  scrub(isvalue = 1)
geomin_rot
knitr::kable(describe(geomin_rot), caption = "Descriptive stats", digits = 2)
```
From the ESEM data remove missing values before using for either EFA and CFA analyses.
```{r}
data_esemcomplete<-data_esem[complete.cases(data_esem),]
knitr::kable(describe(data_esemcomplete), caption = "Descriptive stats", digits = 2)
```
More cleaning is needed as -3 scores exist and SDQ should not have negative scores
Thus an extra cleaning step should be added before progressing.
The next step is for the ESEM five factor modelas a new object to be calculated before fitted.
```{r}
esem_loadings<-as_tibble(geomin_rot, rownames=NA)%>%
  rownames_to_column(var = "item")
fixed<-0.4
syntax<-esem_loadings%>%
  pivot_longer(-item, names_to="latent", values_to="value" )%>%
  mutate(is_anchor=case_when(
           is.na(value) ~ TRUE,
           TRUE ~ FALSE 
           ),
         syntax=case_when(
           is_anchor ~ item,
           TRUE ~ paste0("start(",fixed,")*", item)
         )
  )%>%
  select(latent, syntax)
esem_model<-syntax%>%
  group_by(latent)%>%
  mutate(syntax=paste0(latent, "=~", paste0(syntax, collapse="+")))%>%
  distinct(latent, .keep_all = TRUE)%>%
  ungroup()%>%
  select(-latent)
  
esem_model<-paste0(esem_model$syntax, "\n", collapse="")
writeLines(esem_model)
```
Finally we fit the model and claulate the reliabilities
```{r}
esem_fit <- cfa(esem_model, data_esem, std.lv=T, estimator="WLS")
summary(esem_fit, fit.measures=TRUE, standardized=TRUE)
reliability(esem_fit, omit.imps = c("no.conv", "no.se"))
lavaanPlot(model = esem_fit, coefs = TRUE,
           stand = TRUE,
           edge_options = list(color ='grey'))
```


---
title: "ESEM SDQ Three Factor Model Time Point 2"
author: "Vas Stavropoulos Qasim Latifi based on Maria Prokofieva Syntax"
date: "28/02/2022"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Fist step: Install and Run your package library
#install.packages("lavaan")
#install.packages("lavaanPlot")
#install.packages("semPlot")
#install.packages("EFA.dimensions")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("semtools)
library(lavaan)
library(lavaanPlot)
library(semPlot)
library(EFA.dimensions)
library(tidyverse)
library(psych)
library(semTools)
library (haven)
```
Second step: Import, access and assess the descriptives of your data. Data needs to be placed in the same file that connects with your github directory.You only need to replace your file's name on the following R syntax.

```{r}
data<-haven::read_sav("DATA.sav")%>%
  mutate_if(is.character, as.factor) 
glimpse(data)
knitr::kable(describe(data), caption = "Descriptive stats", digits = 2)
```
Third step: Create and use EFA "blocks" as part of a SEM model. 
EFA blocks can use either *Geomin* rotation or *target* rotations.
Both types of rotations are oblique, meaning they reorient the factors so that they fall closer to clusters of vectors representing manifest variables, thereby simplifying the mathematical description of the manifest variables. Usually geomin rotation outperforms target.

Thus we first create a main factors items' loadings list object.

```{r}
main_loadings_list <- list(
                        ID= c("s3_2", "s8_2", "s13_2", "s16_2", "s24_2", "s6_2", "s11_2R", "s14_2R", "s19_2", "s23_2"),
                        ED= c("s5_2", "s7_2R", "s12_2", "s18_2", "s22_2", "s2_2", "s10_2", "s15_2", "s21_2R", "s25_2R"),
                        ProSocial= c("s1_2", "s4_2", "s9_2", "s17_2", "s20_2"))

                          
```
Then based on the list created you select the factor columns required for your ESEM.
```{r}
data_esem<-data%>%
  select(all_of(unlist(main_loadings_list, use.names=FALSE)))
knitr::kable(describe(data_esem), caption = "Descriptive stats", digits = 2)
```
Then you rotate and use the loadings of this rotation for the preselected factors and items are calculated as a new object
```{r}
geomin_rot <- make.keys(data_esem, main_loadings_list)%>%
  scrub(isvalue = 1)
geomin_rot
knitr::kable(describe(geomin_rot), caption = "Descriptive stats", digits = 2)
```
From the ESEM data remove missing values before using for either EFA and CFA analyses.
```{r}
data_esemcomplete<-data_esem[complete.cases(data_esem),]
knitr::kable(describe(data_esemcomplete), caption = "Descriptive stats", digits = 2)
```
More cleaning is needed as -3 scores exist and SDQ should not have negative scores
Thus an extra cleaning step should be added before progressing.
The next step is for the ESEM five factor modelas a new object to be calculated before fitted.
```{r}
esem_loadings<-as_tibble(geomin_rot, rownames=NA)%>%
  rownames_to_column(var = "item")
fixed<-0.4
syntax<-esem_loadings%>%
  pivot_longer(-item, names_to="latent", values_to="value" )%>%
  mutate(is_anchor=case_when(
           is.na(value) ~ TRUE,
           TRUE ~ FALSE 
           ),
         syntax=case_when(
           is_anchor ~ item,
           TRUE ~ paste0("start(",fixed,")*", item)
         )
  )%>%
  select(latent, syntax)
esem_model<-syntax%>%
  group_by(latent)%>%
  mutate(syntax=paste0(latent, "=~", paste0(syntax, collapse="+")))%>%
  distinct(latent, .keep_all = TRUE)%>%
  ungroup()%>%
  select(-latent)
  
esem_model<-paste0(esem_model$syntax, "\n", collapse="")
writeLines(esem_model)
```
Finally we fit the model and claulate the reliabilities
```{r}
esem_fit <- cfa(esem_model, data_esem, std.lv=T, estimator="WLS")
summary(esem_fit, fit.measures=TRUE, standardized=TRUE)
reliability(esem_fit, omit.imps = c("no.conv", "no.se"))
lavaanPlot(model = esem_fit, coefs = TRUE,
           stand = TRUE,
           edge_options = list(color ='grey'))
```



---
title: "ESEM SDQ Three Factor Model Time Point 3"
author: "Vas Stavropoulos Qasim Latifi based on Maria Prokofieva Syntax"
date: "28/02/2022"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Fist step: Install and Run your package library
#install.packages("lavaan")
#install.packages("lavaanPlot")
#install.packages("semPlot")
#install.packages("EFA.dimensions")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("semtools)
library(lavaan)
library(lavaanPlot)
library(semPlot)
library(EFA.dimensions)
library(tidyverse)
library(psych)
library(semTools)
library (haven)
```
Second step: Import, access and assess the descriptives of your data. Data needs to be placed in the same file that connects with your github directory.You only need to replace your file's name on the following R syntax.

```{r}
data<-haven::read_sav("DATA.sav")%>%
  mutate_if(is.character, as.factor) 
glimpse(data)
knitr::kable(describe(data), caption = "Descriptive stats", digits = 2)
```
Third step: Create and use EFA "blocks" as part of a SEM model. 
EFA blocks can use either *Geomin* rotation or *target* rotations.
Both types of rotations are oblique, meaning they reorient the factors so that they fall closer to clusters of vectors representing manifest variables, thereby simplifying the mathematical description of the manifest variables. Usually geomin rotation outperforms target.

Thus we first create a main factors items' loadings list object.

```{r}
main_loadings_list <- list(
                        ID= c("s3_3", "s8_3", "s13_3", "s16_3", "s24_3", "s6_3", "s11_3R", "s14_3R", "s19_3", "s23_3"),
                        ED= c("s5_3", "s7_3R", "s12_3", "s18_3", "s22_3", "s2_3", "s10_3", "s15_3", "s21_3R", "s25_3R"),
                        ProSocial= c("s1_1", "s4_3", "s9_3", "s17_3", "s20_3"))

                          
```
Then based on the list created you select the factor columns required for your ESEM.
```{r}
data_esem<-data%>%
  select(all_of(unlist(main_loadings_list, use.names=FALSE)))
knitr::kable(describe(data_esem), caption = "Descriptive stats", digits = 2)
```
Then you rotate and use the loadings of this rotation for the preselected factors and items are calculated as a new object
```{r}
geomin_rot <- make.keys(data_esem, main_loadings_list)%>%
  scrub(isvalue = 1)
geomin_rot
knitr::kable(describe(geomin_rot), caption = "Descriptive stats", digits = 2)
```
From the ESEM data remove missing values before using for either EFA and CFA analyses.
```{r}
data_esemcomplete<-data_esem[complete.cases(data_esem),]
knitr::kable(describe(data_esemcomplete), caption = "Descriptive stats", digits = 2)
```
More cleaning is needed as -3 scores exist and SDQ should not have negative scores
Thus an extra cleaning step should be added before progressing.
The next step is for the ESEM five factor modelas a new object to be calculated before fitted.
```{r}
esem_loadings<-as_tibble(geomin_rot, rownames=NA)%>%
  rownames_to_column(var = "item")
fixed<-0.4
syntax<-esem_loadings%>%
  pivot_longer(-item, names_to="latent", values_to="value" )%>%
  mutate(is_anchor=case_when(
           is.na(value) ~ TRUE,
           TRUE ~ FALSE 
           ),
         syntax=case_when(
           is_anchor ~ item,
           TRUE ~ paste0("start(",fixed,")*", item)
         )
  )%>%
  select(latent, syntax)
esem_model<-syntax%>%
  group_by(latent)%>%
  mutate(syntax=paste0(latent, "=~", paste0(syntax, collapse="+")))%>%
  distinct(latent, .keep_all = TRUE)%>%
  ungroup()%>%
  select(-latent)
  
esem_model<-paste0(esem_model$syntax, "\n", collapse="")
writeLines(esem_model)
```
Finally we fit the model and claulate the reliabilities
```{r}
esem_fit <- cfa(esem_model, data_esem, std.lv=T, estimator="WLS")
summary(esem_fit, fit.measures=TRUE, standardized=TRUE)
reliability(esem_fit, omit.imps = c("no.conv", "no.se"))
lavaanPlot(model = esem_fit, coefs = TRUE,
           stand = TRUE,
           edge_options = list(color ='grey'))
```

---
title: "ESEM SDQ Three Factor Model Dicky & Blumberg (2004) Time Point 1"
author: "Vas Stavropoulos Qasim Latifi based on Maria Prokofieva Syntax"
date: "28/02/2022"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Fist step: Install and Run your package library
#install.packages("lavaan")
#install.packages("lavaanPlot")
#install.packages("semPlot")
#install.packages("EFA.dimensions")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("semtools)
library(lavaan)
library(lavaanPlot)
library(semPlot)
library(EFA.dimensions)
library(tidyverse)
library(psych)
library(semTools)
library (haven)
```
Second step: Import, access and assess the descriptives of your data. Data needs to be placed in the same file that connects with your github directory.You only need to replace your file's name on the following R syntax.

```{r}
data<-haven::read_sav("DATA.sav")%>%
  mutate_if(is.character, as.factor) 
glimpse(data)
knitr::kable(describe(data), caption = "Descriptive stats", digits = 2)
```
Third step: Create and use EFA "blocks" as part of a SEM model. 
EFA blocks can use either *Geomin* rotation or *target* rotations.
Both types of rotations are oblique, meaning they reorient the factors so that they fall closer to clusters of vectors representing manifest variables, thereby simplifying the mathematical description of the manifest variables. Usually geomin rotation outperforms target.

Thus we first create a main factors items' loadings list object.

```{r}
main_loadings_list <- list(
                        ID= c("s3_1", "s6_1", "s8_1", "s16_1", "s19_1", "s23_1", "s24_1"),

ED= c("s2_1", "s5_1", "s10_1", "s12_1", "s15_1", "s18_1", "s21_1", "s25_1"),

ProSocial= c("s1_1", "s4_1", "s9_1", "s17_1", "s20_1", "s7_1"))

                          
```
Then based on the list created you select the factor columns required for your ESEM.
```{r}
data_esem<-data%>%
  select(all_of(unlist(main_loadings_list, use.names=FALSE)))
knitr::kable(describe(data_esem), caption = "Descriptive stats", digits = 2)
```
Then you rotate and use the loadings of this rotation for the preselected factors and items are calculated as a new object
```{r}
geomin_rot <- make.keys(data_esem, main_loadings_list)%>%
  scrub(isvalue = 1)
geomin_rot
knitr::kable(describe(geomin_rot), caption = "Descriptive stats", digits = 2)
```
From the ESEM data remove missing values before using for either EFA and CFA analyses.
```{r}
data_esemcomplete<-data_esem[complete.cases(data_esem),]
knitr::kable(describe(data_esemcomplete), caption = "Descriptive stats", digits = 2)
```
More cleaning is needed as -3 scores exist and SDQ should not have negative scores
Thus an extra cleaning step should be added before progressing.
The next step is for the ESEM five factor modelas a new object to be calculated before fitted.
```{r}
esem_loadings<-as_tibble(geomin_rot, rownames=NA)%>%
  rownames_to_column(var = "item")
fixed<-0.4
syntax<-esem_loadings%>%
  pivot_longer(-item, names_to="latent", values_to="value" )%>%
  mutate(is_anchor=case_when(
           is.na(value) ~ TRUE,
           TRUE ~ FALSE 
           ),
         syntax=case_when(
           is_anchor ~ item,
           TRUE ~ paste0("start(",fixed,")*", item)
         )
  )%>%
  select(latent, syntax)
esem_model<-syntax%>%
  group_by(latent)%>%
  mutate(syntax=paste0(latent, "=~", paste0(syntax, collapse="+")))%>%
  distinct(latent, .keep_all = TRUE)%>%
  ungroup()%>%
  select(-latent)
  
esem_model<-paste0(esem_model$syntax, "\n", collapse="")
writeLines(esem_model)
```
Finally we fit the model and claulate the reliabilities
```{r}
esem_fit <- cfa(esem_model, data_esem, std.lv=T, estimator="WLS")
summary(esem_fit, fit.measures=TRUE, standardized=TRUE)
reliability(esem_fit, omit.imps = c("no.conv", "no.se"))
lavaanPlot(model = esem_fit, coefs = TRUE,
           stand = TRUE,
           edge_options = list(color ='grey'))
```

---
title: "ESEM SDQ Three Factor Model Dicky & Blumberg (2004) Time Point 2"
author: "Vas Stavropoulos Qasim Latifi based on Maria Prokofieva Syntax"
date: "28/02/2022"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Fist step: Install and Run your package library
#install.packages("lavaan")
#install.packages("lavaanPlot")
#install.packages("semPlot")
#install.packages("EFA.dimensions")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("semtools)
library(lavaan)
library(lavaanPlot)
library(semPlot)
library(EFA.dimensions)
library(tidyverse)
library(psych)
library(semTools)
library (haven)
```
Second step: Import, access and assess the descriptives of your data. Data needs to be placed in the same file that connects with your github directory.You only need to replace your file's name on the following R syntax.

```{r}
data<-haven::read_sav("DATA.sav")%>%
  mutate_if(is.character, as.factor) 
glimpse(data)
knitr::kable(describe(data), caption = "Descriptive stats", digits = 2)
```
Third step: Create and use EFA "blocks" as part of a SEM model. 
EFA blocks can use either *Geomin* rotation or *target* rotations.
Both types of rotations are oblique, meaning they reorient the factors so that they fall closer to clusters of vectors representing manifest variables, thereby simplifying the mathematical description of the manifest variables. Usually geomin rotation outperforms target.

Thus we first create a main factors items' loadings list object.

```{r}
main_loadings_list <- list(
                        ID= c("s3_2", "s6_2", "s8_2", "s16_2", "s19_2", "s23_2", "s24_2"),

ED= c("s2_2", "s5_2", "s10_2", "s12_2", "s15_2", "s18_2", "s21_2", "s25_2"),

ProSocial= c("s1_2", "s4_2", "s9_2", "s17_2", "s20_2", "s7_2"))

                          
```
Then based on the list created you select the factor columns required for your ESEM.
```{r}
data_esem<-data%>%
  select(all_of(unlist(main_loadings_list, use.names=FALSE)))
knitr::kable(describe(data_esem), caption = "Descriptive stats", digits = 2)
```
Then you rotate and use the loadings of this rotation for the preselected factors and items are calculated as a new object
```{r}
geomin_rot <- make.keys(data_esem, main_loadings_list)%>%
  scrub(isvalue = 1)
geomin_rot
knitr::kable(describe(geomin_rot), caption = "Descriptive stats", digits = 2)
```
From the ESEM data remove missing values before using for either EFA and CFA analyses.
```{r}
data_esemcomplete<-data_esem[complete.cases(data_esem),]
knitr::kable(describe(data_esemcomplete), caption = "Descriptive stats", digits = 2)
```
More cleaning is needed as -3 scores exist and SDQ should not have negative scores
Thus an extra cleaning step should be added before progressing.
The next step is for the ESEM five factor modelas a new object to be calculated before fitted.
```{r}
esem_loadings<-as_tibble(geomin_rot, rownames=NA)%>%
  rownames_to_column(var = "item")
fixed<-0.4
syntax<-esem_loadings%>%
  pivot_longer(-item, names_to="latent", values_to="value" )%>%
  mutate(is_anchor=case_when(
           is.na(value) ~ TRUE,
           TRUE ~ FALSE 
           ),
         syntax=case_when(
           is_anchor ~ item,
           TRUE ~ paste0("start(",fixed,")*", item)
         )
  )%>%
  select(latent, syntax)
esem_model<-syntax%>%
  group_by(latent)%>%
  mutate(syntax=paste0(latent, "=~", paste0(syntax, collapse="+")))%>%
  distinct(latent, .keep_all = TRUE)%>%
  ungroup()%>%
  select(-latent)
  
esem_model<-paste0(esem_model$syntax, "\n", collapse="")
writeLines(esem_model)
```
Finally we fit the model and claulate the reliabilities
```{r}
esem_fit <- cfa(esem_model, data_esem, std.lv=T, estimator="WLS")
summary(esem_fit, fit.measures=TRUE, standardized=TRUE)
reliability(esem_fit, omit.imps = c("no.conv", "no.se"))
lavaanPlot(model = esem_fit, coefs = TRUE,
           stand = TRUE,
           edge_options = list(color ='grey'))
```


---
title: "ESEM SDQ Three Factor Model Dicky & Blumberg (2004) Time Point 3"
author: "Vas Stavropoulos Qasim Latifi based on Maria Prokofieva Syntax"
date: "28/02/2022"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Fist step: Install and Run your package library
#install.packages("lavaan")
#install.packages("lavaanPlot")
#install.packages("semPlot")
#install.packages("EFA.dimensions")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("semtools)
library(lavaan)
library(lavaanPlot)
library(semPlot)
library(EFA.dimensions)
library(tidyverse)
library(psych)
library(semTools)
library (haven)
```
Second step: Import, access and assess the descriptives of your data. Data needs to be placed in the same file that connects with your github directory.You only need to replace your file's name on the following R syntax.

```{r}
data<-haven::read_sav("DATA.sav")%>%
  mutate_if(is.character, as.factor) 
glimpse(data)
knitr::kable(describe(data), caption = "Descriptive stats", digits = 2)
```
Third step: Create and use EFA "blocks" as part of a SEM model. 
EFA blocks can use either *Geomin* rotation or *target* rotations.
Both types of rotations are oblique, meaning they reorient the factors so that they fall closer to clusters of vectors representing manifest variables, thereby simplifying the mathematical description of the manifest variables. Usually geomin rotation outperforms target.

Thus we first create a main factors items' loadings list object.

```{r}
main_loadings_list <- list(
                        ID= c("s3_3", "s6_3", "s8_3", "s16_3", "s19_3", "s23_3", "s24_3"),

ED= c("s2_3", "s5_3", "s10_3", "s12_3", "s15_3", "s18_3", "s21_3", "s25_3"),

ProSocial= c("s1_3", "s4_3", "s9_3", "s17_3", "s20_3", "s7_3"))

                          
```
Then based on the list created you select the factor columns required for your ESEM.
```{r}
data_esem<-data%>%
  select(all_of(unlist(main_loadings_list, use.names=FALSE)))
knitr::kable(describe(data_esem), caption = "Descriptive stats", digits = 2)
```
Then you rotate and use the loadings of this rotation for the preselected factors and items are calculated as a new object
```{r}
geomin_rot <- make.keys(data_esem, main_loadings_list)%>%
  scrub(isvalue = 1)
geomin_rot
knitr::kable(describe(geomin_rot), caption = "Descriptive stats", digits = 2)
```
From the ESEM data remove missing values before using for either EFA and CFA analyses.
```{r}
data_esemcomplete<-data_esem[complete.cases(data_esem),]
knitr::kable(describe(data_esemcomplete), caption = "Descriptive stats", digits = 2)
```
More cleaning is needed as -3 scores exist and SDQ should not have negative scores
Thus an extra cleaning step should be added before progressing.
The next step is for the ESEM five factor modelas a new object to be calculated before fitted.
```{r}
esem_loadings<-as_tibble(geomin_rot, rownames=NA)%>%
  rownames_to_column(var = "item")
fixed<-0.4
syntax<-esem_loadings%>%
  pivot_longer(-item, names_to="latent", values_to="value" )%>%
  mutate(is_anchor=case_when(
           is.na(value) ~ TRUE,
           TRUE ~ FALSE 
           ),
         syntax=case_when(
           is_anchor ~ item,
           TRUE ~ paste0("start(",fixed,")*", item)
         )
  )%>%
  select(latent, syntax)
esem_model<-syntax%>%
  group_by(latent)%>%
  mutate(syntax=paste0(latent, "=~", paste0(syntax, collapse="+")))%>%
  distinct(latent, .keep_all = TRUE)%>%
  ungroup()%>%
  select(-latent)
  
esem_model<-paste0(esem_model$syntax, "\n", collapse="")
writeLines(esem_model)
```
Finally we fit the model and claulate the reliabilities
```{r}
esem_fit <- cfa(esem_model, data_esem, std.lv=T, estimator="WLS")
summary(esem_fit, fit.measures=TRUE, standardized=TRUE)
reliability(esem_fit, omit.imps = c("no.conv", "no.se"))
lavaanPlot(model = esem_fit, coefs = TRUE,
           stand = TRUE,
           edge_options = list(color ='grey'))
```

---
title: "ESEM SDQ Five Factor Model Point 1"
author: "Vas Stavropoulos Qasim Latifi based on Maria Prokofieva Syntax"
date: "28/02/2022"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Fist step: Install and Run your package library
#install.packages("lavaan")
#install.packages("lavaanPlot")
#install.packages("semPlot")
#install.packages("EFA.dimensions")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("semtools)
library(lavaan)
library(lavaanPlot)
library(semPlot)
library(EFA.dimensions)
library(tidyverse)
library(psych)
library(semTools)
library (haven)
```
Second step: Import, access and assess the descriptives of your data. Data needs to be placed in the same file that connects with your github directory.You only need to replace your file's name on the following R syntax.

```{r}
data<-haven::read_sav("DATA.sav")%>%
  mutate_if(is.character, as.factor) 
glimpse(data)
knitr::kable(describe(data), caption = "Descriptive stats", digits = 2)
```
Third step: Create and use EFA "blocks" as part of a SEM model. 
EFA blocks can use either *Geomin* rotation or *target* rotations.
Both types of rotations are oblique, meaning they reorient the factors so that they fall closer to clusters of vectors representing manifest variables, thereby simplifying the mathematical description of the manifest variables. Usually geomin rotation outperforms target.

Thus we first create a main factors items' loadings list object.

```{r}
main_loadings_list <- list(
                      PP= c("s6_1", "s11_1R", "s14_1R", "s19_1", "s23_1"),
                      CP= c("s5_1", "s7_1R", "s12_1", "s18_1", "s22_1"),
                      ES= c("s3_1", "s8_1", "s13_1", "s16_1", "s24_1"),
                      HI= c("s2_1", "s10_1", "s15_1", "s21_1R", "s25_1R"),
                      Prosocial= c("s1_1", "s4_1", "s9_1", "s17_1", "s20_1"))

                          
```
Then based on the list created you select the factor columns required for your ESEM.
```{r}
data_esem<-data%>%
  select(all_of(unlist(main_loadings_list, use.names=FALSE)))
knitr::kable(describe(data_esem), caption = "Descriptive stats", digits = 2)
```
Then you rotate and use the loadings of this rotation for the preselected factors and items are calculated as a new object
```{r}
geomin_rot <- make.keys(data_esem, main_loadings_list)%>%
  scrub(isvalue = 1)
geomin_rot
knitr::kable(describe(geomin_rot), caption = "Descriptive stats", digits = 2)
```
From the ESEM data remove missing values before using for either EFA and CFA analyses.
```{r}
data_esemcomplete<-data_esem[complete.cases(data_esem),]
knitr::kable(describe(data_esemcomplete), caption = "Descriptive stats", digits = 2)
```
More cleaning is needed as -3 scores exist and SDQ should not have negative scores
Thus an extra cleaning step should be added before progressing.
The next step is for the ESEM five factor modelas a new object to be calculated before fitted.
```{r}
esem_loadings<-as_tibble(geomin_rot, rownames=NA)%>%
  rownames_to_column(var = "item")
fixed<-0.4
syntax<-esem_loadings%>%
  pivot_longer(-item, names_to="latent", values_to="value" )%>%
  mutate(is_anchor=case_when(
           is.na(value) ~ TRUE,
           TRUE ~ FALSE 
           ),
         syntax=case_when(
           is_anchor ~ item,
           TRUE ~ paste0("start(",fixed,")*", item)
         )
  )%>%
  select(latent, syntax)
esem_model<-syntax%>%
  group_by(latent)%>%
  mutate(syntax=paste0(latent, "=~", paste0(syntax, collapse="+")))%>%
  distinct(latent, .keep_all = TRUE)%>%
  ungroup()%>%
  select(-latent)
  
esem_model<-paste0(esem_model$syntax, "\n", collapse="")
writeLines(esem_model)
```
Finally we fit the model and claulate the reliabilities
```{r}
esem_fit <- cfa(esem_model, data_esem, std.lv=T, estimator="WLS")
summary(esem_fit, fit.measures=TRUE, standardized=TRUE)
reliability(esem_fit, omit.imps = c("no.conv", "no.se"))
lavaanPlot(model = esem_fit, coefs = TRUE,
           stand = TRUE,
           edge_options = list(color ='grey'))
```



---
title: "ESEM SDQ Five Factor Model Point 2"
author: "Vas Stavropoulos Qasim Latifi based on Maria Prokofieva Syntax"
date: "28/02/2022"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Fist step: Install and Run your package library
#install.packages("lavaan")
#install.packages("lavaanPlot")
#install.packages("semPlot")
#install.packages("EFA.dimensions")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("semtools)
library(lavaan)
library(lavaanPlot)
library(semPlot)
library(EFA.dimensions)
library(tidyverse)
library(psych)
library(semTools)
library (haven)
```
Second step: Import, access and assess the descriptives of your data. Data needs to be placed in the same file that connects with your github directory.You only need to replace your file's name on the following R syntax.

```{r}
data<-haven::read_sav("DATA.sav")%>%
  mutate_if(is.character, as.factor) 
glimpse(data)
knitr::kable(describe(data), caption = "Descriptive stats", digits = 2)
```
Third step: Create and use EFA "blocks" as part of a SEM model. 
EFA blocks can use either *Geomin* rotation or *target* rotations.
Both types of rotations are oblique, meaning they reorient the factors so that they fall closer to clusters of vectors representing manifest variables, thereby simplifying the mathematical description of the manifest variables. Usually geomin rotation outperforms target.

Thus we first create a main factors items' loadings list object.

```{r}
main_loadings_list <- list(
                      PP= c("s6_2", "s11_2R", "s14_2R", "s19_2", "s23_2"),
                      CP= c("s5_2", "s7_2R", "s12_2", "s18_2", "s22_2"),
                      ES= c("s3_2", "s8_2", "s13_2", "s16_2", "s24_2"),
                      HI= c("s2_2", "s10_2", "s15_2", "s21_2R", "s25_2R"),
                      Prosocial= c("s1_2", "s4_2", "s9_2", "s17_2", "s20_2"))

                          
```
Then based on the list created you select the factor columns required for your ESEM.
```{r}
data_esem<-data%>%
  select(all_of(unlist(main_loadings_list, use.names=FALSE)))
knitr::kable(describe(data_esem), caption = "Descriptive stats", digits = 2)
```
Then you rotate and use the loadings of this rotation for the preselected factors and items are calculated as a new object
```{r}
geomin_rot <- make.keys(data_esem, main_loadings_list)%>%
  scrub(isvalue = 1)
geomin_rot
knitr::kable(describe(geomin_rot), caption = "Descriptive stats", digits = 2)
```
From the ESEM data remove missing values before using for either EFA and CFA analyses.
```{r}
data_esemcomplete<-data_esem[complete.cases(data_esem),]
knitr::kable(describe(data_esemcomplete), caption = "Descriptive stats", digits = 2)
```
More cleaning is needed as -3 scores exist and SDQ should not have negative scores
Thus an extra cleaning step should be added before progressing.
The next step is for the ESEM five factor modelas a new object to be calculated before fitted.
```{r}
esem_loadings<-as_tibble(geomin_rot, rownames=NA)%>%
  rownames_to_column(var = "item")
fixed<-0.4
syntax<-esem_loadings%>%
  pivot_longer(-item, names_to="latent", values_to="value" )%>%
  mutate(is_anchor=case_when(
           is.na(value) ~ TRUE,
           TRUE ~ FALSE 
           ),
         syntax=case_when(
           is_anchor ~ item,
           TRUE ~ paste0("start(",fixed,")*", item)
         )
  )%>%
  select(latent, syntax)
esem_model<-syntax%>%
  group_by(latent)%>%
  mutate(syntax=paste0(latent, "=~", paste0(syntax, collapse="+")))%>%
  distinct(latent, .keep_all = TRUE)%>%
  ungroup()%>%
  select(-latent)
  
esem_model<-paste0(esem_model$syntax, "\n", collapse="")
writeLines(esem_model)
```
Finally we fit the model and claulate the reliabilities
```{r}
esem_fit <- cfa(esem_model, data_esem, std.lv=T, estimator="WLS")
summary(esem_fit, fit.measures=TRUE, standardized=TRUE)
reliability(esem_fit, omit.imps = c("no.conv", "no.se"))
lavaanPlot(model = esem_fit, coefs = TRUE,
           stand = TRUE,
           edge_options = list(color ='grey'))
```

---
title: "ESEM SDQ Five Factor Model Point 3"
author: "Vas Stavropoulos Qasim Latifi based on Maria Prokofieva Syntax"
date: "28/02/2022"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Fist step: Install and Run your package library
#install.packages("lavaan")
#install.packages("lavaanPlot")
#install.packages("semPlot")
#install.packages("EFA.dimensions")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("semtools)
library(lavaan)
library(lavaanPlot)
library(semPlot)
library(EFA.dimensions)
library(tidyverse)
library(psych)
library(semTools)
library (haven)
```
Second step: Import, access and assess the descriptives of your data. Data needs to be placed in the same file that connects with your github directory.You only need to replace your file's name on the following R syntax.

```{r}
data<-haven::read_sav("DATA.sav")%>%
  mutate_if(is.character, as.factor) 
glimpse(data)
knitr::kable(describe(data), caption = "Descriptive stats", digits = 2)
```
Third step: Create and use EFA "blocks" as part of a SEM model. 
EFA blocks can use either *Geomin* rotation or *target* rotations.
Both types of rotations are oblique, meaning they reorient the factors so that they fall closer to clusters of vectors representing manifest variables, thereby simplifying the mathematical description of the manifest variables. Usually geomin rotation outperforms target.

Thus we first create a main factors items' loadings list object.

```{r}
main_loadings_list <- list(
                      PP= c("s6_3", "s11_3R", "s14_3R", "s19_3", "s23_3"),
                      CP= c("s5_3", "s7_3R", "s12_3", "s18_3", "s22_3"),
                      ES= c("s3_3", "s8_3", "s13_3", "s16_3", "s24_3"),
                      HI= c("s2_3", "s10_3", "s15_3", "s21_3R", "s25_3R"),
                      Prosocial= c("s1_3", "s4_3", "s9_3", "s17_3", "s20_3"))

                          
```
Then based on the list created you select the factor columns required for your ESEM.
```{r}
data_esem<-data%>%
  select(all_of(unlist(main_loadings_list, use.names=FALSE)))
knitr::kable(describe(data_esem), caption = "Descriptive stats", digits = 2)
```
Then you rotate and use the loadings of this rotation for the preselected factors and items are calculated as a new object
```{r}
geomin_rot <- make.keys(data_esem, main_loadings_list)%>%
  scrub(isvalue = 1)
geomin_rot
knitr::kable(describe(geomin_rot), caption = "Descriptive stats", digits = 2)
```
From the ESEM data remove missing values before using for either EFA and CFA analyses.
```{r}
data_esemcomplete<-data_esem[complete.cases(data_esem),]
knitr::kable(describe(data_esemcomplete), caption = "Descriptive stats", digits = 2)
```
More cleaning is needed as -3 scores exist and SDQ should not have negative scores
Thus an extra cleaning step should be added before progressing.
The next step is for the ESEM five factor modelas a new object to be calculated before fitted.
```{r}
esem_loadings<-as_tibble(geomin_rot, rownames=NA)%>%
  rownames_to_column(var = "item")
fixed<-0.4
syntax<-esem_loadings%>%
  pivot_longer(-item, names_to="latent", values_to="value" )%>%
  mutate(is_anchor=case_when(
           is.na(value) ~ TRUE,
           TRUE ~ FALSE 
           ),
         syntax=case_when(
           is_anchor ~ item,
           TRUE ~ paste0("start(",fixed,")*", item)
         )
  )%>%
  select(latent, syntax)
esem_model<-syntax%>%
  group_by(latent)%>%
  mutate(syntax=paste0(latent, "=~", paste0(syntax, collapse="+")))%>%
  distinct(latent, .keep_all = TRUE)%>%
  ungroup()%>%
  select(-latent)
  
esem_model<-paste0(esem_model$syntax, "\n", collapse="")
writeLines(esem_model)
```
Finally we fit the model and claulate the reliabilities
```{r}
esem_fit <- cfa(esem_model, data_esem, std.lv=T, estimator="WLS")
summary(esem_fit, fit.measures=TRUE, standardized=TRUE)
reliability(esem_fit, omit.imps = c("no.conv", "no.se"))
lavaanPlot(model = esem_fit, coefs = TRUE,
           stand = TRUE,
           edge_options = list(color ='grey'))
```

---
title: "ESEM SDQ Five Factor Model with Positive Construal Factor Point 1"
author: "Vas Stavropoulos Qasim Latifi based on Maria Prokofieva Syntax"
date: "28/02/2022"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Fist step: Install and Run your package library
#install.packages("lavaan")
#install.packages("lavaanPlot")
#install.packages("semPlot")
#install.packages("EFA.dimensions")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("semtools)
library(lavaan)
library(lavaanPlot)
library(semPlot)
library(EFA.dimensions)
library(tidyverse)
library(psych)
library(semTools)
library (haven)
```
Second step: Import, access and assess the descriptives of your data. Data needs to be placed in the same file that connects with your github directory.You only need to replace your file's name on the following R syntax.

```{r}
data<-haven::read_sav("DATA.sav")%>%
  mutate_if(is.character, as.factor) 
glimpse(data)
knitr::kable(describe(data), caption = "Descriptive stats", digits = 2)
```
Third step: Create and use EFA "blocks" as part of a SEM model. 
EFA blocks can use either *Geomin* rotation or *target* rotations.
Both types of rotations are oblique, meaning they reorient the factors so that they fall closer to clusters of vectors representing manifest variables, thereby simplifying the mathematical description of the manifest variables. Usually geomin rotation outperforms target.

Thus we first create a main factors items' loadings list object.

```{r}
main_loadings_list <- list(
                      PP= c("s6_1", "s11_1R", "s14_1R", "s19_1", "s23_1"),
                      CP= c("s5_1", "s7_1R", "s12_1", "s18_1", "s22_1"),
                      ES= c("s3_1", "s8_1", "s13_1", "s16_1", "s24_1"),
                      HI= c("s2_1", "s10_1", "s15_1", "s21_1R", "s25_1R"),
                      Prosocial= c("s1_1", "s4_1", "s9_1", "s17_1", "s20_1"),
                      PCF= c("s1_1", "s4_1", "s9_1", "s17_1", "s20_1", "s7_1R", "s11_1R", "s14_1R", "s21_1R", "s25_1R"))

                          
```
Then based on the list created you select the factor columns required for your ESEM.
```{r}
data_esem<-data%>%
  select(all_of(unlist(main_loadings_list, use.names=FALSE)))
knitr::kable(describe(data_esem), caption = "Descriptive stats", digits = 2)
```
Then you rotate and use the loadings of this rotation for the preselected factors and items are calculated as a new object
```{r}
geomin_rot <- make.keys(data_esem, main_loadings_list)%>%
  scrub(isvalue = 1)
geomin_rot
knitr::kable(describe(geomin_rot), caption = "Descriptive stats", digits = 2)
```
From the ESEM data remove missing values before using for either EFA and CFA analyses.
```{r}
data_esemcomplete<-data_esem[complete.cases(data_esem),]
knitr::kable(describe(data_esemcomplete), caption = "Descriptive stats", digits = 2)
```
More cleaning is needed as -3 scores exist and SDQ should not have negative scores
Thus an extra cleaning step should be added before progressing.
The next step is for the ESEM five factor modelas a new object to be calculated before fitted.
```{r}
esem_loadings<-as_tibble(geomin_rot, rownames=NA)%>%
  rownames_to_column(var = "item")
fixed<-0.4
syntax<-esem_loadings%>%
  pivot_longer(-item, names_to="latent", values_to="value" )%>%
  mutate(is_anchor=case_when(
           is.na(value) ~ TRUE,
           TRUE ~ FALSE 
           ),
         syntax=case_when(
           is_anchor ~ item,
           TRUE ~ paste0("start(",fixed,")*", item)
         )
  )%>%
  select(latent, syntax)
esem_model<-syntax%>%
  group_by(latent)%>%
  mutate(syntax=paste0(latent, "=~", paste0(syntax, collapse="+")))%>%
  distinct(latent, .keep_all = TRUE)%>%
  ungroup()%>%
  select(-latent)
  
esem_model<-paste0(esem_model$syntax, "\n", collapse="")
writeLines(esem_model)
```
Finally we fit the model and claulate the reliabilities
```{r}
esem_fit <- cfa(esem_model, data_esem, std.lv=T, estimator="WLS")
summary(esem_fit, fit.measures=TRUE, standardized=TRUE)
reliability(esem_fit, omit.imps = c("no.conv", "no.se"))
lavaanPlot(model = esem_fit, coefs = TRUE,
           stand = TRUE,
           edge_options = list(color ='grey'))
```


---
title: "ESEM SDQ Five Factor Model with Positive Construal Factor Point 2"
author: "Vas Stavropoulos Qasim Latifi based on Maria Prokofieva Syntax"
date: "28/02/2022"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Fist step: Install and Run your package library
#install.packages("lavaan")
#install.packages("lavaanPlot")
#install.packages("semPlot")
#install.packages("EFA.dimensions")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("semtools)
library(lavaan)
library(lavaanPlot)
library(semPlot)
library(EFA.dimensions)
library(tidyverse)
library(psych)
library(semTools)
library (haven)
```
Second step: Import, access and assess the descriptives of your data. Data needs to be placed in the same file that connects with your github directory.You only need to replace your file's name on the following R syntax.

```{r}
data<-haven::read_sav("DATA.sav")%>%
  mutate_if(is.character, as.factor) 
glimpse(data)
knitr::kable(describe(data), caption = "Descriptive stats", digits = 2)
```
Third step: Create and use EFA "blocks" as part of a SEM model. 
EFA blocks can use either *Geomin* rotation or *target* rotations.
Both types of rotations are oblique, meaning they reorient the factors so that they fall closer to clusters of vectors representing manifest variables, thereby simplifying the mathematical description of the manifest variables. Usually geomin rotation outperforms target.

Thus we first create a main factors items' loadings list object.

```{r}
main_loadings_list <- list(
                      PP= c("s6_2", "s11_2R", "s14_2R", "s19_2", "s23_2"),
                      CP= c("s5_2", "s7_2R", "s12_2", "s18_2", "s22_2"),
                      ES= c("s3_2", "s8_2", "s13_2", "s16_2", "s24_2"),
                      HI= c("s2_2", "s10_2", "s15_2", "s21_2R", "s25_2R"),
                      Prosocial= c("s1_2", "s4_2", "s9_2", "s17_2", "s20_2"),
                      PCF= c("s1_2", "s4_2", "s9_2", "s17_2", "s20_2", "s7_2R", "s11_2R", "s14_2R", "s21_2R", "s25_1R"))

                          
```
Then based on the list created you select the factor columns required for your ESEM.
```{r}
data_esem<-data%>%
  select(all_of(unlist(main_loadings_list, use.names=FALSE)))
knitr::kable(describe(data_esem), caption = "Descriptive stats", digits = 2)
```
Then you rotate and use the loadings of this rotation for the preselected factors and items are calculated as a new object
```{r}
geomin_rot <- make.keys(data_esem, main_loadings_list)%>%
  scrub(isvalue = 1)
geomin_rot
knitr::kable(describe(geomin_rot), caption = "Descriptive stats", digits = 2)
```
From the ESEM data remove missing values before using for either EFA and CFA analyses.
```{r}
data_esemcomplete<-data_esem[complete.cases(data_esem),]
knitr::kable(describe(data_esemcomplete), caption = "Descriptive stats", digits = 2)
```
More cleaning is needed as -3 scores exist and SDQ should not have negative scores
Thus an extra cleaning step should be added before progressing.
The next step is for the ESEM five factor modelas a new object to be calculated before fitted.
```{r}
esem_loadings<-as_tibble(geomin_rot, rownames=NA)%>%
  rownames_to_column(var = "item")
fixed<-0.4
syntax<-esem_loadings%>%
  pivot_longer(-item, names_to="latent", values_to="value" )%>%
  mutate(is_anchor=case_when(
           is.na(value) ~ TRUE,
           TRUE ~ FALSE 
           ),
         syntax=case_when(
           is_anchor ~ item,
           TRUE ~ paste0("start(",fixed,")*", item)
         )
  )%>%
  select(latent, syntax)
esem_model<-syntax%>%
  group_by(latent)%>%
  mutate(syntax=paste0(latent, "=~", paste0(syntax, collapse="+")))%>%
  distinct(latent, .keep_all = TRUE)%>%
  ungroup()%>%
  select(-latent)
  
esem_model<-paste0(esem_model$syntax, "\n", collapse="")
writeLines(esem_model)
```
Finally we fit the model and claulate the reliabilities
```{r}
esem_fit <- cfa(esem_model, data_esem, std.lv=T, estimator="WLS")
summary(esem_fit, fit.measures=TRUE, standardized=TRUE)
reliability(esem_fit, omit.imps = c("no.conv", "no.se"))
lavaanPlot(model = esem_fit, coefs = TRUE,
           stand = TRUE,
           edge_options = list(color ='grey'))
```

---
title: "ESEM SDQ Five Factor Model with Positive Construal Factor Point 3"
author: "Vas Stavropoulos Qasim Latifi based on Maria Prokofieva Syntax"
date: "28/02/2022"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Fist step: Install and Run your package library
#install.packages("lavaan")
#install.packages("lavaanPlot")
#install.packages("semPlot")
#install.packages("EFA.dimensions")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("semtools)
library(lavaan)
library(lavaanPlot)
library(semPlot)
library(EFA.dimensions)
library(tidyverse)
library(psych)
library(semTools)
library (haven)
```
Second step: Import, access and assess the descriptives of your data. Data needs to be placed in the same file that connects with your github directory.You only need to replace your file's name on the following R syntax.

```{r}
data<-haven::read_sav("DATA.sav")%>%
  mutate_if(is.character, as.factor) 
glimpse(data)
knitr::kable(describe(data), caption = "Descriptive stats", digits = 2)
```
Third step: Create and use EFA "blocks" as part of a SEM model. 
EFA blocks can use either *Geomin* rotation or *target* rotations.
Both types of rotations are oblique, meaning they reorient the factors so that they fall closer to clusters of vectors representing manifest variables, thereby simplifying the mathematical description of the manifest variables. Usually geomin rotation outperforms target.

Thus we first create a main factors items' loadings list object.

```{r}
main_loadings_list <- list(
                      PP= c("s6_3", "s11_3R", "s14_3R", "s19_3", "s23_3"),
                      CP= c("s5_3", "s7_3R", "s12_3", "s18_3", "s22_3"),
                      ES= c("s3_3", "s8_3", "s13_3", "s16_3", "s24_3"),
                      HI= c("s2_3", "s10_3", "s15_3", "s21_3R", "s25_3R"),
                      Prosocial= c("s1_3", "s4_3", "s9_3", "s17_3", "s20_3"),
                      PCF= c("s1_3", "s4_3", "s9_3", "s17_3", "s20_3", "s7_3R", "s11_3R", "s14_3R", "s21_3R", "s25_3R"))

                          
```
Then based on the list created you select the factor columns required for your ESEM.
```{r}
data_esem<-data%>%
  select(all_of(unlist(main_loadings_list, use.names=FALSE)))
knitr::kable(describe(data_esem), caption = "Descriptive stats", digits = 2)
```
Then you rotate and use the loadings of this rotation for the preselected factors and items are calculated as a new object
```{r}
geomin_rot <- make.keys(data_esem, main_loadings_list)%>%
  scrub(isvalue = 1)
geomin_rot
knitr::kable(describe(geomin_rot), caption = "Descriptive stats", digits = 2)
```
From the ESEM data remove missing values before using for either EFA and CFA analyses.
```{r}
data_esemcomplete<-data_esem[complete.cases(data_esem),]
knitr::kable(describe(data_esemcomplete), caption = "Descriptive stats", digits = 2)
```
More cleaning is needed as -3 scores exist and SDQ should not have negative scores
Thus an extra cleaning step should be added before progressing.
The next step is for the ESEM five factor modelas a new object to be calculated before fitted.
```{r}
esem_loadings<-as_tibble(geomin_rot, rownames=NA)%>%
  rownames_to_column(var = "item")
fixed<-0.4
syntax<-esem_loadings%>%
  pivot_longer(-item, names_to="latent", values_to="value" )%>%
  mutate(is_anchor=case_when(
           is.na(value) ~ TRUE,
           TRUE ~ FALSE 
           ),
         syntax=case_when(
           is_anchor ~ item,
           TRUE ~ paste0("start(",fixed,")*", item)
         )
  )%>%
  select(latent, syntax)
esem_model<-syntax%>%
  group_by(latent)%>%
  mutate(syntax=paste0(latent, "=~", paste0(syntax, collapse="+")))%>%
  distinct(latent, .keep_all = TRUE)%>%
  ungroup()%>%
  select(-latent)
  
esem_model<-paste0(esem_model$syntax, "\n", collapse="")
writeLines(esem_model)
```
Finally we fit the model and claulate the reliabilities
```{r}
esem_fit <- cfa(esem_model, data_esem, std.lv=T, estimator="WLS")
summary(esem_fit, fit.measures=TRUE, standardized=TRUE)
reliability(esem_fit, omit.imps = c("no.conv", "no.se"))
lavaanPlot(model = esem_fit, coefs = TRUE,
           stand = TRUE,
           edge_options = list(color ='grey'))
```

---
title: "ESEM SDQ Five Factor Bi-Factor Model Time Point 1"
author: "Vas Stavropoulos Qasim Latifi based on Maria Prokofieva Syntax"
date: "28/02/2022"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Fist step: Install and Run your package library
#install.packages("lavaan")
#install.packages("lavaanPlot")
#install.packages("semPlot")
#install.packages("EFA.dimensions")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("semtools)
library(lavaan)
library(lavaanPlot)
library(semPlot)
library(EFA.dimensions)
library(tidyverse)
library(psych)
library(semTools)
library (haven)
```
Second step: Import, access and assess the descriptives of your data. Data needs to be placed in the same file that connects with your github directory.You only need to replace your file's name on the following R syntax.

```{r}
data<-haven::read_sav("DATA.sav")%>%
  mutate_if(is.character, as.factor) 
glimpse(data)
knitr::kable(describe(data), caption = "Descriptive stats", digits = 2)
```
Third step: Create and use EFA "blocks" as part of a SEM model. 
EFA blocks can use either *Geomin* rotation or *target* rotations.
Both types of rotations are oblique, meaning they reorient the factors so that they fall closer to clusters of vectors representing manifest variables, thereby simplifying the mathematical description of the manifest variables. Usually geomin rotation outperforms target.

Thus we first create a main factors items' loadings list object.

```{r}
main_loadings_list <- list(
                      PP= c("s6_1", "s11_1R", "s14_1R", "s19_1", "s23_1"),
                      CP= c("s5_1", "s7_1R", "s12_1", "s18_1", "s22_1"),
                      ES= c("s3_1", "s8_1", "s13_1", "s16_1", "s24_1"),
                      HI= c("s2_1", "s10_1", "s15_1", "s21_1R", "s25_1R"),
                      Prosocial= c("s1_1", "s4_1", "s9_1", "s17_1", "s20_1"),
                      
                      GF= c("s1_1", "s2_1", "s3_1", "s4_1", "s5_1", "s6_1", "s7_1R", "s8_1", "s9_1", "s10_1", "s11_1R", "s12_1", "s13_1", "s14_1R", "s15_1", "s16_1", "s17_1", "s18_1", "s19_1", "s20_1", "s21_1R", "s22_1", "s23_1", "s24_1", "s25_1R"))

                          
```
Then based on the list created you select the factor columns required for your ESEM.
```{r}
data_esem<-data%>%
  select(all_of(unlist(main_loadings_list, use.names=FALSE)))
knitr::kable(describe(data_esem), caption = "Descriptive stats", digits = 2)
```
Then you rotate and use the loadings of this rotation for the preselected factors and items are calculated as a new object
```{r}
geomin_rot <- make.keys(data_esem, main_loadings_list)%>%
  scrub(isvalue = 1)
geomin_rot
knitr::kable(describe(geomin_rot), caption = "Descriptive stats", digits = 2)
```
From the ESEM data remove missing values before using for either EFA and CFA analyses.
```{r}
data_esemcomplete<-data_esem[complete.cases(data_esem),]
knitr::kable(describe(data_esemcomplete), caption = "Descriptive stats", digits = 2)
```
More cleaning is needed as -3 scores exist and SDQ should not have negative scores
Thus an extra cleaning step should be added before progressing.
The next step is for the ESEM five factor modelas a new object to be calculated before fitted.
```{r}
esem_loadings<-as_tibble(geomin_rot, rownames=NA)%>%
  rownames_to_column(var = "item")
fixed<-0.4
syntax<-esem_loadings%>%
  pivot_longer(-item, names_to="latent", values_to="value" )%>%
  mutate(is_anchor=case_when(
           is.na(value) ~ TRUE,
           TRUE ~ FALSE 
           ),
         syntax=case_when(
           is_anchor ~ item,
           TRUE ~ paste0("start(",fixed,")*", item)
         )
  )%>%
  select(latent, syntax)
esem_model<-syntax%>%
  group_by(latent)%>%
  mutate(syntax=paste0(latent, "=~", paste0(syntax, collapse="+")))%>%
  distinct(latent, .keep_all = TRUE)%>%
  ungroup()%>%
  select(-latent)
  
esem_model<-paste0(esem_model$syntax, "\n", collapse="")
writeLines(esem_model)
```
Finally we fit the model and claulate the reliabilities
```{r}
esem_fit <- cfa(esem_model, data_esem, std.lv=T, estimator="WLS")
summary(esem_fit, fit.measures=TRUE, standardized=TRUE)
reliability(esem_fit, omit.imps = c("no.conv", "no.se"))
lavaanPlot(model = esem_fit, coefs = TRUE,
           stand = TRUE,
           edge_options = list(color ='grey'))
```

---
title: "ESEM SDQ Five Factor Bi-Factor Model Time Point 2"
author: "Vas Stavropoulos Qasim Latifi based on Maria Prokofieva Syntax"
date: "28/02/2022"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Fist step: Install and Run your package library
#install.packages("lavaan")
#install.packages("lavaanPlot")
#install.packages("semPlot")
#install.packages("EFA.dimensions")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("semtools)
library(lavaan)
library(lavaanPlot)
library(semPlot)
library(EFA.dimensions)
library(tidyverse)
library(psych)
library(semTools)
library (haven)
```
Second step: Import, access and assess the descriptives of your data. Data needs to be placed in the same file that connects with your github directory.You only need to replace your file's name on the following R syntax.

```{r}
data<-haven::read_sav("DATA.sav")%>%
  mutate_if(is.character, as.factor) 
glimpse(data)
knitr::kable(describe(data), caption = "Descriptive stats", digits = 2)
```
Third step: Create and use EFA "blocks" as part of a SEM model. 
EFA blocks can use either *Geomin* rotation or *target* rotations.
Both types of rotations are oblique, meaning they reorient the factors so that they fall closer to clusters of vectors representing manifest variables, thereby simplifying the mathematical description of the manifest variables. Usually geomin rotation outperforms target.

Thus we first create a main factors items' loadings list object.

```{r}
main_loadings_list <- list(
                      PP= c("s6_2", "s11_2R", "s14_2R", "s19_2", "s23_2"),
                      CP= c("s5_2", "s7_2R", "s12_2", "s18_2", "s22_2"),
                      ES= c("s3_2", "s8_2", "s13_2", "s16_2", "s24_2"),
                      HI= c("s2_2", "s10_2", "s15_2", "s21_2R", "s25_2R"),
                      Prosocial= c("s1_2", "s4_2", "s9_2", "s17_2", "s20_2"),
                      
                      GF= c("s1_2", "s2_2", "s3_2", "s4_2", "s5_2", "s6_2", "s7_2R", "s8_2", "s9_2", "s10_2", "s11_2R", "s12_2", "s13_2", "s14_2R", "s15_2", "s16_2", "s17_2", "s18_2", "s19_2", "s20_2", "s21_2R", "s22_2", "s23_2", "s24_2", "s25_2R"))

                          
```
Then based on the list created you select the factor columns required for your ESEM.
```{r}
data_esem<-data%>%
  select(all_of(unlist(main_loadings_list, use.names=FALSE)))
knitr::kable(describe(data_esem), caption = "Descriptive stats", digits = 2)
```
Then you rotate and use the loadings of this rotation for the preselected factors and items are calculated as a new object
```{r}
geomin_rot <- make.keys(data_esem, main_loadings_list)%>%
  scrub(isvalue = 1)
geomin_rot
knitr::kable(describe(geomin_rot), caption = "Descriptive stats", digits = 2)
```
From the ESEM data remove missing values before using for either EFA and CFA analyses.
```{r}
data_esemcomplete<-data_esem[complete.cases(data_esem),]
knitr::kable(describe(data_esemcomplete), caption = "Descriptive stats", digits = 2)
```
More cleaning is needed as -3 scores exist and SDQ should not have negative scores
Thus an extra cleaning step should be added before progressing.
The next step is for the ESEM five factor modelas a new object to be calculated before fitted.
```{r}
esem_loadings<-as_tibble(geomin_rot, rownames=NA)%>%
  rownames_to_column(var = "item")
fixed<-0.4
syntax<-esem_loadings%>%
  pivot_longer(-item, names_to="latent", values_to="value" )%>%
  mutate(is_anchor=case_when(
           is.na(value) ~ TRUE,
           TRUE ~ FALSE 
           ),
         syntax=case_when(
           is_anchor ~ item,
           TRUE ~ paste0("start(",fixed,")*", item)
         )
  )%>%
  select(latent, syntax)
esem_model<-syntax%>%
  group_by(latent)%>%
  mutate(syntax=paste0(latent, "=~", paste0(syntax, collapse="+")))%>%
  distinct(latent, .keep_all = TRUE)%>%
  ungroup()%>%
  select(-latent)
  
esem_model<-paste0(esem_model$syntax, "\n", collapse="")
writeLines(esem_model)
```
Finally we fit the model and claulate the reliabilities
```{r}
esem_fit <- cfa(esem_model, data_esem, std.lv=T, estimator="WLS")
summary(esem_fit, fit.measures=TRUE, standardized=TRUE)
reliability(esem_fit, omit.imps = c("no.conv", "no.se"))
lavaanPlot(model = esem_fit, coefs = TRUE,
           stand = TRUE,
           edge_options = list(color ='grey'))
```
---
title: "ESEM SDQ Five Factor Bi-Factor Model Time Point 3"
author: "Vas Stavropoulos Qasim Latifi based on Maria Prokofieva Syntax"
date: "28/02/2022"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Fist step: Install and Run your package library
#install.packages("lavaan")
#install.packages("lavaanPlot")
#install.packages("semPlot")
#install.packages("EFA.dimensions")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("semtools)
library(lavaan)
library(lavaanPlot)
library(semPlot)
library(EFA.dimensions)
library(tidyverse)
library(psych)
library(semTools)
library (haven)
```
Second step: Import, access and assess the descriptives of your data. Data needs to be placed in the same file that connects with your github directory.You only need to replace your file's name on the following R syntax.

```{r}
data<-haven::read_sav("DATA.sav")%>%
  mutate_if(is.character, as.factor) 
glimpse(data)
knitr::kable(describe(data), caption = "Descriptive stats", digits = 2)
```
Third step: Create and use EFA "blocks" as part of a SEM model. 
EFA blocks can use either *Geomin* rotation or *target* rotations.
Both types of rotations are oblique, meaning they reorient the factors so that they fall closer to clusters of vectors representing manifest variables, thereby simplifying the mathematical description of the manifest variables. Usually geomin rotation outperforms target.

Thus we first create a main factors items' loadings list object.

```{r}
main_loadings_list <- list(
                      PP= c("s6_3", "s11_3R", "s14_3R", "s19_3", "s23_3"),
                      CP= c("s5_3", "s7_3R", "s12_3", "s18_3", "s22_3"),
                      ES= c("s3_3", "s8_3", "s13_3", "s16_3", "s24_3"),
                      HI= c("s2_3", "s10_3", "s15_3", "s21_3R", "s25_3R"),
                      Prosocial= c("s1_3", "s4_3", "s9_3", "s17_3", "s20_3"),
                      
                      GF= c("s1_3", "s2_3", "s3_3", "s4_3", "s5_3", "s6_3", "s7_3R", "s8_3", "s9_3", "s10_3", "s11_3R", "s12_3", "s13_3", "s14_3R", "s15_3", "s16_3", "s17_3", "s18_3", "s19_3", "s20_3", "s21_3R", "s22_3", "s23_3", "s24_3", "s25_3R"))

                          
```
Then based on the list created you select the factor columns required for your ESEM.
```{r}
data_esem<-data%>%
  select(all_of(unlist(main_loadings_list, use.names=FALSE)))
knitr::kable(describe(data_esem), caption = "Descriptive stats", digits = 2)
```
Then you rotate and use the loadings of this rotation for the preselected factors and items are calculated as a new object
```{r}
geomin_rot <- make.keys(data_esem, main_loadings_list)%>%
  scrub(isvalue = 1)
geomin_rot
knitr::kable(describe(geomin_rot), caption = "Descriptive stats", digits = 2)
```
From the ESEM data remove missing values before using for either EFA and CFA analyses.
```{r}
data_esemcomplete<-data_esem[complete.cases(data_esem),]
knitr::kable(describe(data_esemcomplete), caption = "Descriptive stats", digits = 2)
```
More cleaning is needed as -3 scores exist and SDQ should not have negative scores
Thus an extra cleaning step should be added before progressing.
The next step is for the ESEM five factor modelas a new object to be calculated before fitted.
```{r}
esem_loadings<-as_tibble(geomin_rot, rownames=NA)%>%
  rownames_to_column(var = "item")
fixed<-0.4
syntax<-esem_loadings%>%
  pivot_longer(-item, names_to="latent", values_to="value" )%>%
  mutate(is_anchor=case_when(
           is.na(value) ~ TRUE,
           TRUE ~ FALSE 
           ),
         syntax=case_when(
           is_anchor ~ item,
           TRUE ~ paste0("start(",fixed,")*", item)
         )
  )%>%
  select(latent, syntax)
esem_model<-syntax%>%
  group_by(latent)%>%
  mutate(syntax=paste0(latent, "=~", paste0(syntax, collapse="+")))%>%
  distinct(latent, .keep_all = TRUE)%>%
  ungroup()%>%
  select(-latent)
  
esem_model<-paste0(esem_model$syntax, "\n", collapse="")
writeLines(esem_model)
```
Finally we fit the model and claulate the reliabilities
```{r}
esem_fit <- cfa(esem_model, data_esem, std.lv=T, estimator="WLS")
summary(esem_fit, fit.measures=TRUE, standardized=TRUE)
reliability(esem_fit, omit.imps = c("no.conv", "no.se"))
lavaanPlot(model = esem_fit, coefs = TRUE,
           stand = TRUE,
           edge_options = list(color ='grey'))
```

---
title: "ESEM SDQ Five Factor Bi-Factor Model Difficulty and PS correlated Time Point 1 (PS items removed from GF)"
author: "Vas Stavropoulos Qasim Latifi based on Maria Prokofieva Syntax"
date: "28/02/2022"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Fist step: Install and Run your package library
#install.packages("lavaan")
#install.packages("lavaanPlot")
#install.packages("semPlot")
#install.packages("EFA.dimensions")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("semtools)
library(lavaan)
library(lavaanPlot)
library(semPlot)
library(EFA.dimensions)
library(tidyverse)
library(psych)
library(semTools)
library (haven)
```
Second step: Import, access and assess the descriptives of your data. Data needs to be placed in the same file that connects with your github directory.You only need to replace your file's name on the following R syntax.

```{r}
data<-haven::read_sav("DATA.sav")%>%
  mutate_if(is.character, as.factor) 
glimpse(data)
knitr::kable(describe(data), caption = "Descriptive stats", digits = 2)
```
Third step: Create and use EFA "blocks" as part of a SEM model. 
EFA blocks can use either *Geomin* rotation or *target* rotations.
Both types of rotations are oblique, meaning they reorient the factors so that they fall closer to clusters of vectors representing manifest variables, thereby simplifying the mathematical description of the manifest variables. Usually geomin rotation outperforms target.

Thus we first create a main factors items' loadings list object.

```{r}
main_loadings_list <- list(
                      PP= c("s6_1", "s11_1R", "s14_1R", "s19_1", "s23_1"),
                      CP= c("s5_1", "s7_1R", "s12_1", "s18_1", "s22_1"),
                      ES= c("s3_1", "s8_1", "s13_1", "s16_1", "s24_1"),
                      HI= c("s2_1", "s10_1", "s15_1", "s21_1R", "s25_1R"),
                      Prosocial= c("s1_1", "s4_1", "s9_1", "s17_1", "s20_1"),
                      
                      GF= c("s2_1", "s3_1", "s5_1", "s6_1", "s7_1R", "s8_1", "s10_1", "s11_1R", "s12_1", "s13_1", "s14_1R", "s15_1", "s16_1", "s18_1", "s19_1", "s21_1R", "s22_1", "s23_1", "s24_1", "s25_1R"))

                          
```
Then based on the list created you select the factor columns required for your ESEM.
```{r}
data_esem<-data%>%
  select(all_of(unlist(main_loadings_list, use.names=FALSE)))
knitr::kable(describe(data_esem), caption = "Descriptive stats", digits = 2)
```
Then you rotate and use the loadings of this rotation for the preselected factors and items are calculated as a new object
```{r}
geomin_rot <- make.keys(data_esem, main_loadings_list)%>%
  scrub(isvalue = 1)
geomin_rot
knitr::kable(describe(geomin_rot), caption = "Descriptive stats", digits = 2)
```
From the ESEM data remove missing values before using for either EFA and CFA analyses.
```{r}
data_esemcomplete<-data_esem[complete.cases(data_esem),]
knitr::kable(describe(data_esemcomplete), caption = "Descriptive stats", digits = 2)
```
More cleaning is needed as -3 scores exist and SDQ should not have negative scores
Thus an extra cleaning step should be added before progressing.
The next step is for the ESEM five factor modelas a new object to be calculated before fitted.
```{r}
esem_loadings<-as_tibble(geomin_rot, rownames=NA)%>%
  rownames_to_column(var = "item")
fixed<-0.4
syntax<-esem_loadings%>%
  pivot_longer(-item, names_to="latent", values_to="value" )%>%
  mutate(is_anchor=case_when(
           is.na(value) ~ TRUE,
           TRUE ~ FALSE 
           ),
         syntax=case_when(
           is_anchor ~ item,
           TRUE ~ paste0("start(",fixed,")*", item)
         )
  )%>%
  select(latent, syntax)
esem_model<-syntax%>%
  group_by(latent)%>%
  mutate(syntax=paste0(latent, "=~", paste0(syntax, collapse="+")))%>%
  distinct(latent, .keep_all = TRUE)%>%
  ungroup()%>%
  select(-latent)
  
esem_model<-paste0(esem_model$syntax, "\n", collapse="")
writeLines(esem_model)
```
Finally we fit the model and claulate the reliabilities
```{r}
esem_fit <- cfa(esem_model, data_esem, std.lv=T, estimator="WLS")
summary(esem_fit, fit.measures=TRUE, standardized=TRUE)
reliability(esem_fit, omit.imps = c("no.conv", "no.se"))
lavaanPlot(model = esem_fit, coefs = TRUE,
           stand = TRUE,
           edge_options = list(color ='grey'))
```

---
title: "ESEM SDQ Five Factor Bi-Factor Model Time Point 2 Difficulty and PS correlated (PS items removed from GF)"
author: "Vas Stavropoulos Qasim Latifi based on Maria Prokofieva Syntax"
date: "28/02/2022"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Fist step: Install and Run your package library
#install.packages("lavaan")
#install.packages("lavaanPlot")
#install.packages("semPlot")
#install.packages("EFA.dimensions")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("semtools)
library(lavaan)
library(lavaanPlot)
library(semPlot)
library(EFA.dimensions)
library(tidyverse)
library(psych)
library(semTools)
library (haven)
```
Second step: Import, access and assess the descriptives of your data. Data needs to be placed in the same file that connects with your github directory.You only need to replace your file's name on the following R syntax.

```{r}
data<-haven::read_sav("DATA.sav")%>%
  mutate_if(is.character, as.factor) 
glimpse(data)
knitr::kable(describe(data), caption = "Descriptive stats", digits = 2)
```
Third step: Create and use EFA "blocks" as part of a SEM model. 
EFA blocks can use either *Geomin* rotation or *target* rotations.
Both types of rotations are oblique, meaning they reorient the factors so that they fall closer to clusters of vectors representing manifest variables, thereby simplifying the mathematical description of the manifest variables. Usually geomin rotation outperforms target.

Thus we first create a main factors items' loadings list object.

```{r}
main_loadings_list <- list(
                      PP= c("s6_2", "s11_2R", "s14_2R", "s19_2", "s23_2"),
                      CP= c("s5_2", "s7_2R", "s12_2", "s18_2", "s22_2"),
                      ES= c("s3_2", "s8_2", "s13_2", "s16_2", "s24_2"),
                      HI= c("s2_2", "s10_2", "s15_2", "s21_2R", "s25_2R"),
                      Prosocial= c("s1_2", "s4_2", "s9_2", "s17_2", "s20_2"),
                      
                      GF= c("s2_2", "s3_2", "s5_2", "s6_2", "s7_2R", "s8_2", "s10_2", "s11_2R", "s12_2", "s13_2", "s14_2R", "s15_2", "s16_2", "s18_2", "s19_2", "s21_2R", "s22_2", "s23_2", "s24_2", "s25_2R"))

                          
```
Then based on the list created you select the factor columns required for your ESEM.
```{r}
data_esem<-data%>%
  select(all_of(unlist(main_loadings_list, use.names=FALSE)))
knitr::kable(describe(data_esem), caption = "Descriptive stats", digits = 2)
```
Then you rotate and use the loadings of this rotation for the preselected factors and items are calculated as a new object
```{r}
geomin_rot <- make.keys(data_esem, main_loadings_list)%>%
  scrub(isvalue = 1)
geomin_rot
knitr::kable(describe(geomin_rot), caption = "Descriptive stats", digits = 2)
```
From the ESEM data remove missing values before using for either EFA and CFA analyses.
```{r}
data_esemcomplete<-data_esem[complete.cases(data_esem),]
knitr::kable(describe(data_esemcomplete), caption = "Descriptive stats", digits = 2)
```
More cleaning is needed as -3 scores exist and SDQ should not have negative scores
Thus an extra cleaning step should be added before progressing.
The next step is for the ESEM five factor modelas a new object to be calculated before fitted.
```{r}
esem_loadings<-as_tibble(geomin_rot, rownames=NA)%>%
  rownames_to_column(var = "item")
fixed<-0.4
syntax<-esem_loadings%>%
  pivot_longer(-item, names_to="latent", values_to="value" )%>%
  mutate(is_anchor=case_when(
           is.na(value) ~ TRUE,
           TRUE ~ FALSE 
           ),
         syntax=case_when(
           is_anchor ~ item,
           TRUE ~ paste0("start(",fixed,")*", item)
         )
  )%>%
  select(latent, syntax)
esem_model<-syntax%>%
  group_by(latent)%>%
  mutate(syntax=paste0(latent, "=~", paste0(syntax, collapse="+")))%>%
  distinct(latent, .keep_all = TRUE)%>%
  ungroup()%>%
  select(-latent)
  
esem_model<-paste0(esem_model$syntax, "\n", collapse="")
writeLines(esem_model)
```
Finally we fit the model and claulate the reliabilities
```{r}
esem_fit <- cfa(esem_model, data_esem, std.lv=T, estimator="WLS")
summary(esem_fit, fit.measures=TRUE, standardized=TRUE)
reliability(esem_fit, omit.imps = c("no.conv", "no.se"))
lavaanPlot(model = esem_fit, coefs = TRUE,
           stand = TRUE,
           edge_options = list(color ='grey'))
```
---
title: "ESEM SDQ Five Factor Bi-Factor Model Time Point 3 Difficulty and PS correlated (PS items removed from GF)"
author: "Vas Stavropoulos Qasim Latifi based on Maria Prokofieva Syntax"
date: "28/02/2022"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Fist step: Install and Run your package library
#install.packages("lavaan")
#install.packages("lavaanPlot")
#install.packages("semPlot")
#install.packages("EFA.dimensions")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("semtools)
library(lavaan)
library(lavaanPlot)
library(semPlot)
library(EFA.dimensions)
library(tidyverse)
library(psych)
library(semTools)
library (haven)
```
Second step: Import, access and assess the descriptives of your data. Data needs to be placed in the same file that connects with your github directory.You only need to replace your file's name on the following R syntax.

```{r}
data<-haven::read_sav("DATA.sav")%>%
  mutate_if(is.character, as.factor) 
glimpse(data)
knitr::kable(describe(data), caption = "Descriptive stats", digits = 2)
```
Third step: Create and use EFA "blocks" as part of a SEM model. 
EFA blocks can use either *Geomin* rotation or *target* rotations.
Both types of rotations are oblique, meaning they reorient the factors so that they fall closer to clusters of vectors representing manifest variables, thereby simplifying the mathematical description of the manifest variables. Usually geomin rotation outperforms target.

Thus we first create a main factors items' loadings list object.

```{r}
main_loadings_list <- list(
                      PP= c("s6_3", "s11_3R", "s14_3R", "s19_3", "s23_3"),
                      CP= c("s5_3", "s7_3R", "s12_3", "s18_3", "s22_3"),
                      ES= c("s3_3", "s8_3", "s13_3", "s16_3", "s24_3"),
                      HI= c("s2_3", "s10_3", "s15_3", "s21_3R", "s25_3R"),
                      Prosocial= c("s1_3", "s4_3", "s9_3", "s17_3", "s20_3"),
                      
                      GF= c("s2_3", "s3_3", "s5_3", "s6_3", "s7_3R", "s8_3", "s10_3", "s11_3R", "s12_3", "s13_3", "s14_3R", "s15_3", "s16_3", "s18_3", "s19_3", "s21_3R", "s22_3", "s23_3", "s24_3", "s25_3R"))

                          
```
Then based on the list created you select the factor columns required for your ESEM.
```{r}
data_esem<-data%>%
  select(all_of(unlist(main_loadings_list, use.names=FALSE)))
knitr::kable(describe(data_esem), caption = "Descriptive stats", digits = 2)
```
Then you rotate and use the loadings of this rotation for the preselected factors and items are calculated as a new object
```{r}
geomin_rot <- make.keys(data_esem, main_loadings_list)%>%
  scrub(isvalue = 1)
geomin_rot
knitr::kable(describe(geomin_rot), caption = "Descriptive stats", digits = 2)
```
From the ESEM data remove missing values before using for either EFA and CFA analyses.
```{r}
data_esemcomplete<-data_esem[complete.cases(data_esem),]
knitr::kable(describe(data_esemcomplete), caption = "Descriptive stats", digits = 2)
```
More cleaning is needed as -3 scores exist and SDQ should not have negative scores
Thus an extra cleaning step should be added before progressing.
The next step is for the ESEM five factor modelas a new object to be calculated before fitted.
```{r}
esem_loadings<-as_tibble(geomin_rot, rownames=NA)%>%
  rownames_to_column(var = "item")
fixed<-0.4
syntax<-esem_loadings%>%
  pivot_longer(-item, names_to="latent", values_to="value" )%>%
  mutate(is_anchor=case_when(
           is.na(value) ~ TRUE,
           TRUE ~ FALSE 
           ),
         syntax=case_when(
           is_anchor ~ item,
           TRUE ~ paste0("start(",fixed,")*", item)
         )
  )%>%
  select(latent, syntax)
esem_model<-syntax%>%
  group_by(latent)%>%
  mutate(syntax=paste0(latent, "=~", paste0(syntax, collapse="+")))%>%
  distinct(latent, .keep_all = TRUE)%>%
  ungroup()%>%
  select(-latent)
  
esem_model<-paste0(esem_model$syntax, "\n", collapse="")
writeLines(esem_model)
```
Finally we fit the model and claulate the reliabilities
```{r}
esem_fit <- cfa(esem_model, data_esem, std.lv=T, estimator="WLS")
summary(esem_fit, fit.measures=TRUE, standardized=TRUE)
reliability(esem_fit, omit.imps = c("no.conv", "no.se"))
lavaanPlot(model = esem_fit, coefs = TRUE,
           stand = TRUE,
           edge_options = list(color ='grey'))
```



---
title: "ESEM SDQ Five Factor Bi-Factor Model with Two General Factors Time Point 1"
author: "Vas Stavropoulos Qasim Latifi based on Maria Prokofieva Syntax"
date: "28/02/2022"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Fist step: Install and Run your package library
#install.packages("lavaan")
#install.packages("lavaanPlot")
#install.packages("semPlot")
#install.packages("EFA.dimensions")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("semtools)
library(lavaan)
library(lavaanPlot)
library(semPlot)
library(EFA.dimensions)
library(tidyverse)
library(psych)
library(semTools)
library (haven)
```
Second step: Import, access and assess the descriptives of your data. Data needs to be placed in the same file that connects with your github directory.You only need to replace your file's name on the following R syntax.

```{r}
data<-haven::read_sav("DATA.sav")%>%
  mutate_if(is.character, as.factor) 
glimpse(data)
knitr::kable(describe(data), caption = "Descriptive stats", digits = 2)
```
Third step: Create and use EFA "blocks" as part of a SEM model. 
EFA blocks can use either *Geomin* rotation or *target* rotations.
Both types of rotations are oblique, meaning they reorient the factors so that they fall closer to clusters of vectors representing manifest variables, thereby simplifying the mathematical description of the manifest variables. Usually geomin rotation outperforms target.

Thus we first create a main factors items' loadings list object.

```{r}
main_loadings_list <- list(
                      PP= c("s6_1", "s11_1R", "s14_1R", "s19_1", "s23_1"),
                      CP= c("s5_1", "s7_1R", "s12_1", "s18_1", "s22_1"),
                      ES= c("s3_1", "s8_1", "s13_1", "s16_1", "s24_1"),
                      HI= c("s2_1", "s10_1", "s15_1", "s21_1R", "s25_1R"),
                      Prosocial= c("s1_1", "s4_1", "s9_1", "s17_1", "s20_1"),
                      
                      EF= c("s5_1", "s7_1R", "s12_1", "s18_1", "s22_1", "s2_1", "s10_1", "s15_1", "s21_1R", "s25_1R"),
                      IF= c("s6_1", "s11_1R", "s14_1R", "s19_1", "s23_1", "s3_1", "s8_1", "s13_1", "s16_1", "s24_1"))

                          
```
Then based on the list created you select the factor columns required for your ESEM.
```{r}
data_esem<-data%>%
  select(all_of(unlist(main_loadings_list, use.names=FALSE)))
knitr::kable(describe(data_esem), caption = "Descriptive stats", digits = 2)
```
Then you rotate and use the loadings of this rotation for the preselected factors and items are calculated as a new object
```{r}
geomin_rot <- make.keys(data_esem, main_loadings_list)%>%
  scrub(isvalue = 1)
geomin_rot
knitr::kable(describe(geomin_rot), caption = "Descriptive stats", digits = 2)
```
From the ESEM data remove missing values before using for either EFA and CFA analyses.
```{r}
data_esemcomplete<-data_esem[complete.cases(data_esem),]
knitr::kable(describe(data_esemcomplete), caption = "Descriptive stats", digits = 2)
```
More cleaning is needed as -3 scores exist and SDQ should not have negative scores
Thus an extra cleaning step should be added before progressing.
The next step is for the ESEM five factor modelas a new object to be calculated before fitted.
```{r}
esem_loadings<-as_tibble(geomin_rot, rownames=NA)%>%
  rownames_to_column(var = "item")
fixed<-0.4
syntax<-esem_loadings%>%
  pivot_longer(-item, names_to="latent", values_to="value" )%>%
  mutate(is_anchor=case_when(
           is.na(value) ~ TRUE,
           TRUE ~ FALSE 
           ),
         syntax=case_when(
           is_anchor ~ item,
           TRUE ~ paste0("start(",fixed,")*", item)
         )
  )%>%
  select(latent, syntax)
esem_model<-syntax%>%
  group_by(latent)%>%
  mutate(syntax=paste0(latent, "=~", paste0(syntax, collapse="+")))%>%
  distinct(latent, .keep_all = TRUE)%>%
  ungroup()%>%
  select(-latent)
  
esem_model<-paste0(esem_model$syntax, "\n", collapse="")
writeLines(esem_model)
```
Finally we fit the model and claulate the reliabilities
```{r}
esem_fit <- cfa(esem_model, data_esem, std.lv=T, estimator="WLS")
summary(esem_fit, fit.measures=TRUE, standardized=TRUE)
reliability(esem_fit, omit.imps = c("no.conv", "no.se"))
lavaanPlot(model = esem_fit, coefs = TRUE,
           stand = TRUE,
           edge_options = list(color ='grey'))
```

---
title: "ESEM SDQ Five Factor Bi-Factor Model with Two General Factors Time Point 2"
author: "Vas Stavropoulos Qasim Latifi based on Maria Prokofieva Syntax"
date: "28/02/2022"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Fist step: Install and Run your package library
#install.packages("lavaan")
#install.packages("lavaanPlot")
#install.packages("semPlot")
#install.packages("EFA.dimensions")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("semtools)
library(lavaan)
library(lavaanPlot)
library(semPlot)
library(EFA.dimensions)
library(tidyverse)
library(psych)
library(semTools)
library (haven)
```
Second step: Import, access and assess the descriptives of your data. Data needs to be placed in the same file that connects with your github directory.You only need to replace your file's name on the following R syntax.

```{r}
data<-haven::read_sav("DATA.sav")%>%
  mutate_if(is.character, as.factor) 
glimpse(data)
knitr::kable(describe(data), caption = "Descriptive stats", digits = 2)
```
Third step: Create and use EFA "blocks" as part of a SEM model. 
EFA blocks can use either *Geomin* rotation or *target* rotations.
Both types of rotations are oblique, meaning they reorient the factors so that they fall closer to clusters of vectors representing manifest variables, thereby simplifying the mathematical description of the manifest variables. Usually geomin rotation outperforms target.

Thus we first create a main factors items' loadings list object.

```{r}
main_loadings_list <- list(
                      PP= c("s6_2", "s11_2R", "s14_2R", "s19_2", "s23_2"),
                      CP= c("s5_2", "s7_2R", "s12_2", "s18_2", "s22_2"),
                      ES= c("s3_2", "s8_2", "s13_2", "s16_2", "s24_2"),
                      HI= c("s2_2", "s10_2", "s15_2", "s21_2R", "s25_2R"),
                      Prosocial= c("s1_2", "s4_2", "s9_2", "s17_2", "s20_2"),
                      
                      EF= C("s5_2", "s7_2R", "s12_2", "s18_2", "s22_2", "s2_2", "s10_2", "s15_2", "s21_2R", "s25_2R"),
                      IF= c("s6_2", "s11_2R", "s14_2R", "s19_2", "s23_2", "s3_2", "s8_2", "s13_2", "s16_2", "s24_2"))

                          
```
Then based on the list created you select the factor columns required for your ESEM.
```{r}
data_esem<-data%>%
  select(all_of(unlist(main_loadings_list, use.names=FALSE)))
knitr::kable(describe(data_esem), caption = "Descriptive stats", digits = 2)
```
Then you rotate and use the loadings of this rotation for the preselected factors and items are calculated as a new object
```{r}
geomin_rot <- make.keys(data_esem, main_loadings_list)%>%
  scrub(isvalue = 1)
geomin_rot
knitr::kable(describe(geomin_rot), caption = "Descriptive stats", digits = 2)
```
From the ESEM data remove missing values before using for either EFA and CFA analyses.
```{r}
data_esemcomplete<-data_esem[complete.cases(data_esem),]
knitr::kable(describe(data_esemcomplete), caption = "Descriptive stats", digits = 2)
```
More cleaning is needed as -3 scores exist and SDQ should not have negative scores
Thus an extra cleaning step should be added before progressing.
The next step is for the ESEM five factor modelas a new object to be calculated before fitted.
```{r}
esem_loadings<-as_tibble(geomin_rot, rownames=NA)%>%
  rownames_to_column(var = "item")
fixed<-0.4
syntax<-esem_loadings%>%
  pivot_longer(-item, names_to="latent", values_to="value" )%>%
  mutate(is_anchor=case_when(
           is.na(value) ~ TRUE,
           TRUE ~ FALSE 
           ),
         syntax=case_when(
           is_anchor ~ item,
           TRUE ~ paste0("start(",fixed,")*", item)
         )
  )%>%
  select(latent, syntax)
esem_model<-syntax%>%
  group_by(latent)%>%
  mutate(syntax=paste0(latent, "=~", paste0(syntax, collapse="+")))%>%
  distinct(latent, .keep_all = TRUE)%>%
  ungroup()%>%
  select(-latent)
  
esem_model<-paste0(esem_model$syntax, "\n", collapse="")
writeLines(esem_model)
```
Finally we fit the model and claulate the reliabilities
```{r}
esem_fit <- cfa(esem_model, data_esem, std.lv=T, estimator="WLS")
summary(esem_fit, fit.measures=TRUE, standardized=TRUE)
reliability(esem_fit, omit.imps = c("no.conv", "no.se"))
lavaanPlot(model = esem_fit, coefs = TRUE,
           stand = TRUE,
           edge_options = list(color ='grey'))
```
---
title: "ESEM SDQ Five Factor Bi-Factor Model with Two General Factors Time Point 2"
author: "Vas Stavropoulos Qasim Latifi based on Maria Prokofieva Syntax"
date: "28/02/2022"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Fist step: Install and Run your package library
#install.packages("lavaan")
#install.packages("lavaanPlot")
#install.packages("semPlot")
#install.packages("EFA.dimensions")
#install.packages("tidyverse")
#install.packages("psych")
#install.packages("semtools)
library(lavaan)
library(lavaanPlot)
library(semPlot)
library(EFA.dimensions)
library(tidyverse)
library(psych)
library(semTools)
library (haven)
```
Second step: Import, access and assess the descriptives of your data. Data needs to be placed in the same file that connects with your github directory.You only need to replace your file's name on the following R syntax.

```{r}
data<-haven::read_sav("DATA.sav")%>%
  mutate_if(is.character, as.factor) 
glimpse(data)
knitr::kable(describe(data), caption = "Descriptive stats", digits = 2)
```
Third step: Create and use EFA "blocks" as part of a SEM model. 
EFA blocks can use either *Geomin* rotation or *target* rotations.
Both types of rotations are oblique, meaning they reorient the factors so that they fall closer to clusters of vectors representing manifest variables, thereby simplifying the mathematical description of the manifest variables. Usually geomin rotation outperforms target.

Thus we first create a main factors items' loadings list object.

```{r}
main_loadings_list <- list(
                      PP= c("s6_3", "s11_3R", "s14_3R", "s19_3", "s23_3"),
                      CP= c("s5_3", "s7_3R", "s12_3", "s18_3", "s22_3"),
                      ES= c("s3_3", "s8_3", "s13_3", "s16_3", "s24_3"),
                      HI= c("s2_3", "s10_3", "s15_3", "s21_3R", "s25_3R"),
                      Prosocial= c("s1_3", "s4_3", "s9_3", "s17_3", "s20_3"),
                      
                      EF= C("s5_3", "s7_3R", "s12_3", "s18_3", "s22_3", "s2_3", "s10_3", "s15_3", "s21_3R", "s25_3R"))
                      IF= c("s6_3", "s11_3R", "s14_3R", "s19_3", "s23_3", "s3_3", "s8_3", "s13_3", "s16_3", "s24_3"))

                          
```
Then based on the list created you select the factor columns required for your ESEM.
```{r}
data_esem<-data%>%
  select(all_of(unlist(main_loadings_list, use.names=FALSE)))
knitr::kable(describe(data_esem), caption = "Descriptive stats", digits = 2)
```
Then you rotate and use the loadings of this rotation for the preselected factors and items are calculated as a new object
```{r}
geomin_rot <- make.keys(data_esem, main_loadings_list)%>%
  scrub(isvalue = 1)
geomin_rot
knitr::kable(describe(geomin_rot), caption = "Descriptive stats", digits = 2)
```
From the ESEM data remove missing values before using for either EFA and CFA analyses.
```{r}
data_esemcomplete<-data_esem[complete.cases(data_esem),]
knitr::kable(describe(data_esemcomplete), caption = "Descriptive stats", digits = 2)
```
More cleaning is needed as -3 scores exist and SDQ should not have negative scores
Thus an extra cleaning step should be added before progressing.
The next step is for the ESEM five factor modelas a new object to be calculated before fitted.
```{r}
esem_loadings<-as_tibble(geomin_rot, rownames=NA)%>%
  rownames_to_column(var = "item")
fixed<-0.4
syntax<-esem_loadings%>%
  pivot_longer(-item, names_to="latent", values_to="value" )%>%
  mutate(is_anchor=case_when(
           is.na(value) ~ TRUE,
           TRUE ~ FALSE 
           ),
         syntax=case_when(
           is_anchor ~ item,
           TRUE ~ paste0("start(",fixed,")*", item)
         )
  )%>%
  select(latent, syntax)
esem_model<-syntax%>%
  group_by(latent)%>%
  mutate(syntax=paste0(latent, "=~", paste0(syntax, collapse="+")))%>%
  distinct(latent, .keep_all = TRUE)%>%
  ungroup()%>%
  select(-latent)
  
esem_model<-paste0(esem_model$syntax, "\n", collapse="")
writeLines(esem_model)
```
Finally we fit the model and claulate the reliabilities
```{r}
esem_fit <- cfa(esem_model, data_esem, std.lv=T, estimator="WLS")
summary(esem_fit, fit.measures=TRUE, standardized=TRUE)
reliability(esem_fit, omit.imps = c("no.conv", "no.se"))
lavaanPlot(model = esem_fit, coefs = TRUE,
           stand = TRUE,
           edge_options = list(color ='grey'))
```